import{LRUCache as e}from"../utils/cache.js";var a=Object.defineProperty,t=(e,t,s)=>(((e,t,s)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class s{constructor(){t(this,"cache",new e({maxSize:50})),t(this,"loading",new Map),t(this,"loaded",new Set)}async load(e,a,t={}){const{retries:s=3,timeout:o=1e4,cache:n=!0}=t;if(n&&this.cache.has(e))return this.cache.get(e);if(this.loading.has(e))return this.loading.get(e);const i=this.loadWithRetry(a,s,o);this.loading.set(e,i);try{const a=await i;return n&&this.cache.set(e,a),this.loaded.add(e),a}finally{this.loading.delete(e)}}async loadWithRetry(e,a,t){let s=null;for(let o=0;o<=a;o++)try{return await this.withTimeout(e(),t)}catch(e){s=e,o<a&&await this.delay(1e3*Math.pow(2,o))}throw s||new Error("Load failed after retries")}withTimeout(e,a){return Promise.race([e,new Promise((e,t)=>setTimeout(()=>t(new Error("Load timeout")),a))])}delay(e){return new Promise(a=>setTimeout(a,e))}isLoaded(e){return this.loaded.has(e)}async preload(e,a,t){this.isLoaded(e)||("requestIdleCallback"in window?window.requestIdleCallback(()=>{this.load(e,a,t).catch(e=>{})},{timeout:5e3}):setTimeout(()=>{this.load(e,a,t).catch(e=>{})},100))}async preloadBatch(e){const a=e.map(e=>this.preload(e.key,e.loader,e.options));await Promise.allSettled(a)}clearCache(){this.cache.clear()}reset(){this.cache.clear(),this.loading.clear(),this.loaded.clear()}getStats(){return{cached:this.cache.size(),loading:this.loading.size,loaded:this.loaded.size,cacheStats:this.cache.getStats()}}}class o extends s{async loadLanguage(e){const a=`language:${e}`;this.isLoaded(a)||await this.load(a,async()=>{switch(e){case"typescript":case"javascript":return import("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/typescript/monaco.contribution.js");case"json":return import("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/json/monaco.contribution.js");case"html":return import("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/html/monaco.contribution.js");case"css":case"scss":case"less":return import("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/css/monaco.contribution.js");default:return null}})}async preloadCommonLanguages(){await this.preloadBatch(["typescript","javascript","json","html","css"].map(e=>({key:`language:${e}`,loader:()=>this.loadLanguage(e)})))}}class n extends s{async loadTheme(e){const a=`theme:${e}`;return this.load(a,async()=>null)}}class i extends s{async loadPlugin(e){const a=`plugin:${e}`;return this.load(a,async()=>null)}}const r=new o,c=new n,l=new i;export{o as LanguageLazyLoader,s as LazyLoader,i as PluginLazyLoader,n as ThemeLazyLoader,r as languageLoader,l as pluginLoader,c as themeLoader};
//# sourceMappingURL=LazyLoader.js.map
