{"version":3,"file":"EditorLifecycle.js","sources":["../../src/core/EditorLifecycle.ts"],"sourcesContent":["/**\n * 编辑器生命周期管理\n * 管理编辑器实例的创建、初始化、更新和销毁\n */\n\nimport type * as Monaco from 'monaco-editor'\n\nexport enum LifecyclePhase {\n  Creating = 'creating',\n  Initializing = 'initializing',\n  Ready = 'ready',\n  Updating = 'updating',\n  Disposing = 'disposing',\n  Disposed = 'disposed',\n}\n\nexport type LifecycleHook = () => void | Promise<void>\n\nexport interface LifecycleHooks {\n  beforeCreate?: LifecycleHook\n  created?: LifecycleHook\n  beforeMount?: LifecycleHook\n  mounted?: LifecycleHook\n  beforeUpdate?: LifecycleHook\n  updated?: LifecycleHook\n  beforeDispose?: LifecycleHook\n  disposed?: LifecycleHook\n}\n\n/**\n * 编辑器生命周期管理器\n */\nexport class EditorLifecycle {\n  private phase: LifecyclePhase = LifecyclePhase.Creating\n  private hooks: LifecycleHooks = {}\n  private eventListeners: Map<LifecyclePhase, Set<LifecycleHook>> = new Map()\n  private editor: Monaco.editor.IStandaloneCodeEditor | null = null\n\n  constructor(hooks?: LifecycleHooks) {\n    if (hooks) {\n      this.hooks = hooks\n    }\n  }\n\n  /**\n   * 获取当前生命周期阶段\n   */\n  getPhase(): LifecyclePhase {\n    return this.phase\n  }\n\n  /**\n   * 设置编辑器实例\n   */\n  setEditor(editor: Monaco.editor.IStandaloneCodeEditor): void {\n    this.editor = editor\n  }\n\n  /**\n   * 获取编辑器实例\n   */\n  getEditor(): Monaco.editor.IStandaloneCodeEditor | null {\n    return this.editor\n  }\n\n  /**\n   * 注册生命周期钩子\n   */\n  on(phase: LifecyclePhase, hook: LifecycleHook): () => void {\n    if (!this.eventListeners.has(phase)) {\n      this.eventListeners.set(phase, new Set())\n    }\n    this.eventListeners.get(phase)!.add(hook)\n\n    // 返回取消注册函数\n    return () => {\n      this.eventListeners.get(phase)?.delete(hook)\n    }\n  }\n\n  /**\n   * 触发生命周期钩子\n   */\n  private async triggerHook(hookName: keyof LifecycleHooks, phase: LifecyclePhase): Promise<void> {\n    // 触发注册的钩子\n    const hook = this.hooks[hookName]\n    if (hook) {\n      await hook()\n    }\n\n    // 触发事件监听器\n    const listeners = this.eventListeners.get(phase)\n    if (listeners) {\n      for (const listener of listeners) {\n        await listener()\n      }\n    }\n  }\n\n  /**\n   * 创建前\n   */\n  async beforeCreate(): Promise<void> {\n    this.phase = LifecyclePhase.Creating\n    await this.triggerHook('beforeCreate', LifecyclePhase.Creating)\n  }\n\n  /**\n   * 创建后\n   */\n  async created(): Promise<void> {\n    await this.triggerHook('created', LifecyclePhase.Creating)\n  }\n\n  /**\n   * 挂载前\n   */\n  async beforeMount(): Promise<void> {\n    this.phase = LifecyclePhase.Initializing\n    await this.triggerHook('beforeMount', LifecyclePhase.Initializing)\n  }\n\n  /**\n   * 挂载后\n   */\n  async mounted(): Promise<void> {\n    this.phase = LifecyclePhase.Ready\n    await this.triggerHook('mounted', LifecyclePhase.Ready)\n  }\n\n  /**\n   * 更新前\n   */\n  async beforeUpdate(): Promise<void> {\n    this.phase = LifecyclePhase.Updating\n    await this.triggerHook('beforeUpdate', LifecyclePhase.Updating)\n  }\n\n  /**\n   * 更新后\n   */\n  async updated(): Promise<void> {\n    this.phase = LifecyclePhase.Ready\n    await this.triggerHook('updated', LifecyclePhase.Ready)\n  }\n\n  /**\n   * 销毁前\n   */\n  async beforeDispose(): Promise<void> {\n    this.phase = LifecyclePhase.Disposing\n    await this.triggerHook('beforeDispose', LifecyclePhase.Disposing)\n  }\n\n  /**\n   * 销毁后\n   */\n  async disposed(): Promise<void> {\n    this.phase = LifecyclePhase.Disposed\n    await this.triggerHook('disposed', LifecyclePhase.Disposed)\n    this.eventListeners.clear()\n    this.editor = null\n  }\n\n  /**\n   * 检查是否处于某个阶段\n   */\n  is(phase: LifecyclePhase): boolean {\n    return this.phase === phase\n  }\n\n  /**\n   * 检查是否已就绪\n   */\n  isReady(): boolean {\n    return this.phase === LifecyclePhase.Ready\n  }\n\n  /**\n   * 检查是否已销毁\n   */\n  isDisposed(): boolean {\n    return this.phase === LifecyclePhase.Disposed\n  }\n}\n\n/**\n * 生命周期装饰器工厂\n */\nexport function LifecycleDecorator(phase: LifecyclePhase) {\n  return function (\n    _target: unknown,\n    _propertyKey: string,\n    descriptor: PropertyDescriptor\n  ): PropertyDescriptor {\n    const originalMethod = descriptor.value\n\n    descriptor.value = async function (this: { lifecycle?: EditorLifecycle }, ...args: unknown[]) {\n      if (this.lifecycle && !this.lifecycle.is(phase)) {\n        console.warn(`Method called in wrong lifecycle phase. Expected: ${phase}`)\n      }\n      return await originalMethod.apply(this, args)\n    }\n\n    return descriptor\n  }\n}\n\n"],"names":["LifecyclePhase","n","Object","defineProperty","a","o","e","i","enumerable","configurable","writable","value","d","Creating","Initializing","Ready","Updating","Disposing","Disposed","EditorLifecycle","constructor","hooks","__publicField","this","Map","getPhase","phase","setEditor","editor","getEditor","on","hook","eventListeners","has","set","Set","get","add","delete","triggerHook","hookName","listeners","listener","beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDispose","disposed","clear","is","isReady","isDisposed","LifecycleDecorator","_target","_propertyKey","descriptor","originalMethod","async","args","lifecycle","apply"],"mappings":"AAOO,IAAKA,EAALC,EAAAC,OAAAC,eAAAC,EAAA,CAAAC,EAAAC,EAAAC,KAAA,EAAAF,EAAAC,EAAAC,KAAAD,KAAAD,EAAAJ,EAAAI,EAAAC,EAAA,CAAAE,YAAA,EAAAC,cAAA,EAAAC,UAAA,EAAAC,MAAAJ,IAAAF,EAAAC,GAAAC,GAAAK,CAAAP,EAAA,iBAAAC,EAAAA,EAAA,GAAAA,EAAAC,GAAAA,GAAKP,IAAAA,EAAAA,GAAA,CAAA,GACVa,SAAW,WACXb,EAAAc,aAAe,eACfd,EAAAe,MAAQ,QACRf,EAAAgB,SAAW,WACXhB,EAAAiB,UAAY,YACZjB,EAAAkB,SAAW,WANDlB,GAyBL,MAAMmB,EAMX,WAAAC,CAAYC,GALZC,EAAAC,KAAQ,QAAwB,YAChCD,EAAAC,KAAQ,QAAwB,CAAA,GAChCD,EAAAC,KAAQ,iBAA0D,IAAIC,KACtEF,EAAAC,KAAQ,SAAqD,MAGvDF,IACFE,KAAKF,MAAQA,EAEjB,CAKA,QAAAI,GACE,OAAOF,KAAKG,KACd,CAKA,SAAAC,CAAUC,GACRL,KAAKK,OAASA,CAChB,CAKA,SAAAC,GACE,OAAON,KAAKK,MACd,CAKA,EAAAE,CAAGJ,EAAuBK,GACxB,OAAKR,KAAKS,eAAeC,IAAIP,IAC3BH,KAAKS,eAAeE,IAAIR,EAAO,IAAIS,KAErCZ,KAAKS,eAAeI,IAAIV,GAAQW,IAAIN,GAG7B,KACLR,KAAKS,eAAeI,IAAIV,IAAQY,OAAOP,GAE3C,CAKA,iBAAcQ,CAAYC,EAAgCd,GAExD,MAAMK,EAAOR,KAAKF,MAAMmB,GACpBT,SACIA,IAIR,MAAMU,EAAYlB,KAAKS,eAAeI,IAAIV,GAC1C,GAAIe,EACF,IAAA,MAAWC,KAAYD,QACfC,GAGZ,CAKA,kBAAMC,GACJpB,KAAKG,MAAQ,iBACPH,KAAKgB,YAAY,eAAgB,WACzC,CAKA,aAAMK,SACErB,KAAKgB,YAAY,UAAW,WACpC,CAKA,iBAAMM,GACJtB,KAAKG,MAAQ,qBACPH,KAAKgB,YAAY,cAAe,eACxC,CAKA,aAAMO,GACJvB,KAAKG,MAAQ,cACPH,KAAKgB,YAAY,UAAW,QACpC,CAKA,kBAAMQ,GACJxB,KAAKG,MAAQ,iBACPH,KAAKgB,YAAY,eAAgB,WACzC,CAKA,aAAMS,GACJzB,KAAKG,MAAQ,cACPH,KAAKgB,YAAY,UAAW,QACpC,CAKA,mBAAMU,GACJ1B,KAAKG,MAAQ,kBACPH,KAAKgB,YAAY,gBAAiB,YAC1C,CAKA,cAAMW,GACJ3B,KAAKG,MAAQ,iBACPH,KAAKgB,YAAY,WAAY,YACnChB,KAAKS,eAAemB,QACpB5B,KAAKK,OAAS,IAChB,CAKA,EAAAwB,CAAG1B,GACD,OAAOH,KAAKG,QAAUA,CACxB,CAKA,OAAA2B,GACE,MAAsB,UAAf9B,KAAKG,KACd,CAKA,UAAA4B,GACE,MAAsB,aAAf/B,KAAKG,KACd,EAMK,SAAS6B,EAAmB7B,GACjC,OAAO,SACL8B,EACAC,EACAC,GAEA,MAAMC,EAAiBD,EAAW/C,MAElC,OAAA+C,EAAW/C,MAAQiD,kBAA0DC,GAC3E,OAAItC,KAAKuC,WAAcvC,KAAKuC,UAAUV,GAAG1B,SAG5BiC,EAAeI,MAAMxC,KAAMsC,EAC1C,EAEOH,CACT,CACF"}