var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);class s{constructor(t,s={}){e(this,"pool",[]),e(this,"options"),e(this,"stats",{total:0,active:0,idle:0,created:0,reused:0,destroyed:0}),e(this,"cleanupInterval",null),e(this,"editorFactory"),this.editorFactory=t,this.options={minSize:s.minSize||0,maxSize:s.maxSize||10,maxIdleTime:s.maxIdleTime||3e5,warmup:s.warmup||!1},this.options.warmup&&this.warmUp(),this.startCleanup()}warmUp(){const t=this.options.minSize;for(let e=0;e<t;e++){const t=this.createHiddenContainer(),e=this.editorFactory(t);this.pool.push({editor:e,inUse:!1,lastUsed:Date.now(),created:Date.now(),usageCount:0}),this.stats.created++,this.stats.idle++}this.stats.total=this.pool.length}createHiddenContainer(){const t=document.createElement("div");return t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.width="800px",t.style.height="600px",document.body.appendChild(t),t}acquire(t){const e=this.pool.find(t=>!t.inUse);if(e)return e.inUse=!0,e.lastUsed=Date.now(),e.usageCount++,this.stats.active++,this.stats.idle--,this.stats.reused++,e.editor;if(this.pool.length<this.options.maxSize){const e=this.editorFactory(t),s={editor:e,inUse:!0,lastUsed:Date.now(),created:Date.now(),usageCount:1};return this.pool.push(s),this.stats.created++,this.stats.active++,this.stats.total++,e}return this.editorFactory(t)}release(t){const e=this.pool.find(e=>e.editor===t);e&&e.inUse&&(e.inUse=!1,e.lastUsed=Date.now(),this.stats.active--,this.stats.idle++,this.resetEditor(t))}resetEditor(t){try{t.setValue("")}catch(t){}}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4)}cleanup(){const t=Date.now(),e=[];this.pool.forEach((s,i)=>{!s.inUse&&t-s.lastUsed>this.options.maxIdleTime&&this.pool.length>this.options.minSize&&e.push(i)}),e.reverse().forEach(t=>{const e=this.pool[t];try{e.editor.dispose(),this.pool.splice(t,1),this.stats.destroyed++,this.stats.idle--,this.stats.total--}catch(t){}}),e.length}getStats(){return{...this.stats}}size(){return this.pool.length}activeCount(){return this.pool.filter(t=>t.inUse).length}idleCount(){return this.pool.filter(t=>!t.inUse).length}clear(){this.pool.forEach(t=>{try{t.editor.dispose()}catch(t){}}),this.pool=[],this.stats={total:0,active:0,idle:0,created:this.stats.created,reused:this.stats.reused,destroyed:this.stats.destroyed+this.pool.length}}dispose(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.clear()}generateReport(){const t=this.getStats();return`\nEditor Pool Report\n==========================================\nTotal Editors: ${t.total}\nActive: ${t.active}\nIdle: ${t.idle}\nCreated: ${t.created}\nReused: ${t.reused}\nDestroyed: ${t.destroyed}\nReuse Rate: ${t.reused>0?(t.reused/t.created*100).toFixed(2):0}%\n==========================================\n    `.trim()}}export{s as EditorPool};
//# sourceMappingURL=EditorPool.js.map
