{"version":3,"file":"EnhancedCodeEditor.js","sources":["../../src/core/EnhancedCodeEditor.ts"],"sourcesContent":["import * as monaco from 'monaco-editor'\r\nimport { CodeEditor } from './CodeEditor'\r\nimport type {\r\n  ExtendedCodeEditorConfig,\r\n  LoadingState,\r\n  ICodeEditor\r\n} from '../types'\r\nimport { setupMonacoWorkers, preloadLanguages } from '../utils/workers'\r\nimport { PluginManager, registerCommonSnippets } from '../utils/plugins'\r\nimport { \r\n  getLanguageByExtension, \r\n  getRecommendedPlugins,\r\n  configureLanguageDefaults,\r\n  getDefaultTabSize \r\n} from '../utils/language-utils'\r\nimport { ThemeManager } from '../utils/themes'\r\nimport { EditorFeatureManager } from '../utils/features'\r\n\r\n/**\r\n * 增强型代码编辑器\r\n * 包含 Loading 状态、插件系统、主题管理、高级功能等\r\n */\r\nexport class EnhancedCodeEditor extends CodeEditor {\r\n  private loadingState: LoadingState = {\r\n    isLoading: false,\r\n    progress: 0,\r\n    message: ''\r\n  }\r\n  private loadingOverlay: HTMLElement | null = null\r\n  private pluginManager: PluginManager\r\n  private themeManager: ThemeManager\r\n  private featureManager: EditorFeatureManager\r\n  private extendedConfig: ExtendedCodeEditorConfig\r\n  private _isInitialized: boolean = false\r\n\r\n  constructor(container: HTMLElement, config: ExtendedCodeEditorConfig = {}) {\r\n    // 在初始化编辑器前显示 loading\r\n    const showLoading = config.showLoading !== false\r\n    const loadingOverlay = showLoading ? EnhancedCodeEditor.createLoadingOverlay(container, config.loadingText) : null\r\n\r\n    // 存储扩展配置\r\n    const extendedConfig = config\r\n\r\n    // 调用父类构造函数前先不初始化\r\n    // 我们需要异步初始化\r\n    super(container, { ...config, value: config.value || '' })\r\n\r\n    this.extendedConfig = extendedConfig\r\n    this.pluginManager = PluginManager.getInstance()\r\n    this.themeManager = ThemeManager.getInstance()\r\n    this.featureManager = new EditorFeatureManager()\r\n    this.loadingOverlay = loadingOverlay\r\n\r\n    // 异步初始化\r\n    this.asyncInit()\r\n  }\r\n\r\n  /**\r\n   * 异步初始化编辑器\r\n   */\r\n  private async asyncInit(): Promise<void> {\r\n    try {\r\n      this.updateLoadingState(true, 10, '正在初始化编辑器核心...')\r\n\r\n      // 等待编辑器基础初始化完成\r\n      await this.waitForEditor()\r\n\r\n      this.updateLoadingState(true, 20, '正在配置 Monaco Editor Workers...')\r\n\r\n      // 配置 Workers\r\n      setupMonacoWorkers(this.extendedConfig.workers)\r\n\r\n      this.updateLoadingState(true, 30, '正在配置语言支持...')\r\n\r\n      // 配置语言\r\n      const language = this.extendedConfig.language || 'javascript'\r\n      configureLanguageDefaults(language)\r\n      await preloadLanguages([language])\r\n\r\n      // 设置语言特定的 tabSize\r\n      const tabSize = this.extendedConfig.tabSize || getDefaultTabSize(language)\r\n      this.getEditor()?.updateOptions({ tabSize })\r\n\r\n      this.updateLoadingState(true, 40, '正在加载主题...')\r\n\r\n      // 配置主题\r\n      await this.initializeThemes()\r\n\r\n      this.updateLoadingState(true, 50, '正在加载插件...')\r\n\r\n      // 加载插件\r\n      if (this.extendedConfig.plugins) {\r\n        await this.pluginManager.loadByConfig(this.extendedConfig.plugins)\r\n      }\r\n\r\n      // 加载常用代码片段\r\n      if (this.extendedConfig.plugins?.snippets !== false) {\r\n        registerCommonSnippets()\r\n      }\r\n\r\n      // 根据语言自动加载对应插件\r\n      const recommendedPlugins = getRecommendedPlugins(language)\r\n      if (recommendedPlugins.length > 0) {\r\n        await this.pluginManager.loadPlugins(recommendedPlugins)\r\n      }\r\n\r\n      this.updateLoadingState(true, 70, '正在配置编辑器功能...')\r\n\r\n      // 配置高级功能\r\n      await this.initializeFeatures()\r\n\r\n      this.updateLoadingState(true, 85, '正在优化性能设置...')\r\n\r\n      // 应用性能优化\r\n      this.applyPerformanceOptimizations()\r\n\r\n      this.updateLoadingState(true, 95, '正在完成初始化...')\r\n\r\n      // 配置格式化\r\n      this.configureFormatting()\r\n\r\n      // 配置验证\r\n      this.configureValidation()\r\n\r\n      // 配置快捷键\r\n      this.configureKeybindings()\r\n\r\n      this.updateLoadingState(true, 100, '加载完成')\r\n      this._isInitialized = true\r\n\r\n      // 触发初始化完成回调\r\n      if (this.extendedConfig.onInitialized) {\r\n        this.extendedConfig.onInitialized()\r\n      }\r\n\r\n      // 延迟移除 loading，让用户看到完成状态\r\n      setTimeout(() => {\r\n        this.hideLoading()\r\n      }, 300)\r\n    } catch (error) {\r\n      console.error('编辑器初始化失败:', error)\r\n      this.updateLoadingState(false, 0, '加载失败')\r\n      this.hideLoading()\r\n      \r\n      // 触发错误回调\r\n      if (this.extendedConfig.onError) {\r\n        this.extendedConfig.onError(error as Error)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 等待编辑器实例准备就绪\r\n   */\r\n  private async waitForEditor(): Promise<void> {\r\n    return new Promise((resolve) => {\r\n      const checkEditor = () => {\r\n        try {\r\n          const editor = this.getEditor()\r\n          if (editor) {\r\n            resolve()\r\n          } else {\r\n            setTimeout(checkEditor, 50)\r\n          }\r\n        } catch {\r\n          setTimeout(checkEditor, 50)\r\n        }\r\n      }\r\n      checkEditor()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 初始化主题\r\n   */\r\n  private async initializeThemes(): Promise<void> {\r\n    const themeConfig = this.extendedConfig.themes\r\n    \r\n    if (!themeConfig) return\r\n\r\n    // 注册自定义主题\r\n    if (themeConfig.custom) {\r\n      themeConfig.custom.forEach(({ name, data }) => {\r\n        this.themeManager.registerTheme(name, data)\r\n      })\r\n    }\r\n\r\n    // 应用主题\r\n    if (themeConfig.followSystem) {\r\n      // 跟随系统主题\r\n      const theme = this.themeManager.applySystemTheme()\r\n      if (themeConfig.onThemeChange) {\r\n        themeConfig.onThemeChange(theme)\r\n      }\r\n\r\n      // 监听系统主题变化\r\n      this.themeManager.watchSystemTheme((theme) => {\r\n        if (themeConfig.onThemeChange) {\r\n          themeConfig.onThemeChange(theme)\r\n        }\r\n      })\r\n    } else if (themeConfig.default) {\r\n      // 应用默认主题\r\n      this.setTheme(themeConfig.default)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 初始化编辑器功能\r\n   */\r\n  private async initializeFeatures(): Promise<void> {\r\n    const editor = this.getEditor()\r\n    if (!editor) return\r\n\r\n    this.featureManager.setEditor(editor)\r\n\r\n    // 配置功能\r\n    if (this.extendedConfig.features) {\r\n      this.featureManager.configureFeatures(this.extendedConfig.features)\r\n    }\r\n\r\n    // 启用所有增强功能\r\n    if (this.extendedConfig.features?.multiCursor) {\r\n      this.featureManager.enableMultiCursor()\r\n    }\r\n    if (this.extendedConfig.features?.bracketMatching) {\r\n      this.featureManager.enableSmartBrackets()\r\n    }\r\n    if (this.extendedConfig.features?.folding) {\r\n      this.featureManager.enhanceFolding()\r\n    }\r\n    if (this.extendedConfig.features?.find) {\r\n      this.featureManager.enableEnhancedFind()\r\n    }\r\n    if (this.extendedConfig.features?.smartSelect) {\r\n      this.featureManager.enableSmartSelect()\r\n    }\r\n    if (this.extendedConfig.features?.columnSelection) {\r\n      this.featureManager.enableColumnSelection()\r\n    }\r\n    if (this.extendedConfig.features?.minimap) {\r\n      this.featureManager.enhanceMinimap()\r\n    }\r\n\r\n    // 添加自定义快捷键\r\n    this.featureManager.addCustomKeybindings()\r\n    this.featureManager.addContextMenuItems()\r\n  }\r\n\r\n  /**\r\n   * 应用性能优化\r\n   */\r\n  private applyPerformanceOptimizations(): void {\r\n    const perfConfig = this.extendedConfig.performance\r\n    if (!perfConfig) return\r\n\r\n    const editor = this.getEditor()\r\n    if (!editor) return\r\n\r\n    const options: any = {}\r\n\r\n    if (perfConfig.virtualScrolling !== undefined) {\r\n      options.smoothScrolling = perfConfig.virtualScrolling\r\n    }\r\n\r\n    if (perfConfig.largeFileOptimizations) {\r\n      options.largeFileOptimizations = true\r\n      // 设置大文件阈值\r\n      if (perfConfig.largeFileThreshold) {\r\n        const model = editor.getModel()\r\n        if (model && model.getValue().length > perfConfig.largeFileThreshold) {\r\n          options.renderWhitespace = 'none'\r\n          options.renderControlCharacters = false\r\n          options.fontLigatures = false\r\n          options.minimap = { enabled: false }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (perfConfig.syntaxHighlightCache) {\r\n      options.useShadowDOM = true\r\n    }\r\n\r\n    editor.updateOptions(options)\r\n  }\r\n\r\n  /**\r\n   * 配置格式化\r\n   */\r\n  private configureFormatting(): void {\r\n    const formatConfig = this.extendedConfig.formatting\r\n    if (!formatConfig) return\r\n\r\n    const editor = this.getEditor()\r\n    if (!editor) return\r\n\r\n    // 配置格式化选项\r\n    if (formatConfig.formatOnType) {\r\n      editor.updateOptions({ formatOnType: true })\r\n    }\r\n    if (formatConfig.formatOnPaste) {\r\n      editor.updateOptions({ formatOnPaste: true })\r\n    }\r\n\r\n    // 自动格式化\r\n    if (formatConfig.formatOnSave) {\r\n      // 这里可以添加保存时格式化的逻辑\r\n      console.log('Format on save enabled')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 配置验证\r\n   */\r\n  private configureValidation(): void {\r\n    const validationConfig = this.extendedConfig.validation\r\n    if (!validationConfig || !validationConfig.enabled) return\r\n\r\n    // 配置验证选项\r\n    const language = this.extendedConfig.language || 'javascript'\r\n    \r\n    // 这里可以根据语言配置相应的验证规则\r\n    console.log('Validation configured for', language)\r\n  }\r\n\r\n  /**\r\n   * 配置快捷键\r\n   */\r\n  private configureKeybindings(): void {\r\n    const keybindingsConfig = this.extendedConfig.keybindings\r\n    if (!keybindingsConfig) return\r\n\r\n    const editor = this.getEditor()\r\n    if (!editor) return\r\n\r\n    // 添加自定义快捷键\r\n    if (keybindingsConfig.custom) {\r\n      keybindingsConfig.custom.forEach(({ key, command, when }) => {\r\n        // 这里可以解析快捷键字符串并添加到编辑器\r\n        console.log('Custom keybinding:', key, command, when)\r\n      })\r\n    }\r\n\r\n    // 配置快捷键方案\r\n    if (keybindingsConfig.scheme) {\r\n      console.log('Keybinding scheme:', keybindingsConfig.scheme)\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * 更新加载状态\r\n   */\r\n  private updateLoadingState(isLoading: boolean, progress: number, message: string): void {\r\n    this.loadingState = { isLoading, progress, message }\r\n\r\n    // 更新 loading UI\r\n    if (this.loadingOverlay) {\r\n      const progressBar = this.loadingOverlay.querySelector<HTMLElement>('.ld-loading-progress')\r\n      const messageEl = this.loadingOverlay.querySelector<HTMLElement>('.ld-loading-message')\r\n\r\n      if (progressBar) {\r\n        progressBar.style.width = `${progress}%`\r\n      }\r\n\r\n      if (messageEl) {\r\n        messageEl.textContent = message\r\n      }\r\n    }\r\n\r\n    // 触发回调\r\n    if (this.extendedConfig.onLoadingChange) {\r\n      this.extendedConfig.onLoadingChange(this.loadingState)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 隐藏 loading\r\n   */\r\n  private hideLoading(): void {\r\n    if (this.loadingOverlay) {\r\n      this.loadingOverlay.style.opacity = '0'\r\n      setTimeout(() => {\r\n        this.loadingOverlay?.remove()\r\n        this.loadingOverlay = null\r\n      }, 300)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置主题\r\n   */\r\n  setTheme(theme: string): void {\r\n    super.setTheme(theme)\r\n    const themeConfig = this.extendedConfig.themes\r\n    if (themeConfig?.onThemeChange) {\r\n      themeConfig.onThemeChange(theme)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取可用主题列表\r\n   */\r\n  getAvailableThemes(): string[] {\r\n    return this.themeManager.getAvailableThemes()\r\n  }\r\n\r\n  /**\r\n   * 获取功能管理器\r\n   */\r\n  getFeatureManager(): EditorFeatureManager {\r\n    return this.featureManager\r\n  }\r\n\r\n  /**\r\n   * 获取主题管理器\r\n   */\r\n  getThemeManager(): ThemeManager {\r\n    return this.themeManager\r\n  }\r\n\r\n  /**\r\n   * 获取插件管理器\r\n   */\r\n  getPluginManager(): PluginManager {\r\n    return this.pluginManager\r\n  }\r\n\r\n  /**\r\n   * 根据文件名设置语言\r\n   */\r\n  setLanguageByFilename(filename: string): void {\r\n    const language = getLanguageByExtension(filename)\r\n    this.setLanguage(language)\r\n  }\r\n\r\n  /**\r\n   * 获取初始化状态\r\n   */\r\n  get isInitialized(): boolean {\r\n    return this._isInitialized\r\n  }\r\n\r\n  /**\r\n   * 获取编辑器统计信息\r\n   */\r\n  getStats(): any {\r\n    return this.featureManager.getEditorStats()\r\n  }\r\n\r\n  /**\r\n   * 创建 Diff 编辑器\r\n   */\r\n  createDiffEditor(\r\n    container: HTMLElement,\r\n    original: string,\r\n    modified: string,\r\n    language?: string\r\n  ): monaco.editor.IStandaloneDiffEditor {\r\n    return this.featureManager.createDiffEditor(container, original, modified, language)\r\n  }\r\n\r\n  /**\r\n   * 销毁编辑器\r\n   */\r\n  dispose(): void {\r\n    this.featureManager.dispose()\r\n    super.dispose()\r\n  }\r\n\r\n  /**\r\n   * 获取加载状态\r\n   */\r\n  getLoadingState(): LoadingState {\r\n    return { ...this.loadingState }\r\n  }\r\n\r\n  /**\r\n   * 创建 Loading 遮罩层\r\n   */\r\n  private static createLoadingOverlay(container: HTMLElement, customText?: string): HTMLElement {\r\n    const overlay = document.createElement('div')\r\n    overlay.className = 'ld-editor-loading-overlay'\r\n    overlay.innerHTML = `\r\n      <div class=\"ld-loading-spinner\"></div>\r\n      <div class=\"ld-loading-message\">${customText || '正在初始化编辑器...'}</div>\r\n      <div class=\"ld-loading-progress-container\">\r\n        <div class=\"ld-loading-progress\"></div>\r\n      </div>\r\n    `\r\n\r\n    // 添加样式\r\n    const style = document.createElement('style')\r\n    style.textContent = `\r\n      .ld-editor-loading-overlay {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: rgba(30, 30, 30, 0.95);\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 1000;\r\n        transition: opacity 0.3s ease;\r\n      }\r\n\r\n      .ld-loading-spinner {\r\n        width: 40px;\r\n        height: 40px;\r\n        border: 4px solid rgba(255, 255, 255, 0.1);\r\n        border-top-color: #667eea;\r\n        border-radius: 50%;\r\n        animation: ld-spin 0.8s linear infinite;\r\n      }\r\n\r\n      @keyframes ld-spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n\r\n      .ld-loading-message {\r\n        margin-top: 20px;\r\n        color: #fff;\r\n        font-size: 14px;\r\n      }\r\n\r\n      .ld-loading-progress-container {\r\n        width: 200px;\r\n        height: 4px;\r\n        background: rgba(255, 255, 255, 0.1);\r\n        border-radius: 2px;\r\n        margin-top: 15px;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .ld-loading-progress {\r\n        height: 100%;\r\n        background: linear-gradient(90deg, #667eea, #764ba2);\r\n        border-radius: 2px;\r\n        transition: width 0.3s ease;\r\n        width: 0%;\r\n      }\r\n    `\r\n\r\n    container.style.position = 'relative'\r\n    container.appendChild(style)\r\n    container.appendChild(overlay)\r\n\r\n    return overlay\r\n  }\r\n}\r\n\r\n/**\r\n * 创建增强型代码编辑器的便捷函数\r\n */\r\nexport function createEnhancedCodeEditor(\r\n  container: HTMLElement | string,\r\n  config: ExtendedCodeEditorConfig = {}\r\n): ICodeEditor {\r\n  const element = typeof container === 'string'\r\n    ? document.querySelector<HTMLElement>(container)\r\n    : container\r\n\r\n  if (!element) {\r\n    throw new Error('Container element not found')\r\n  }\r\n\r\n  return new EnhancedCodeEditor(element, config)\r\n}\r\n"],"names":["EnhancedCodeEditor","CodeEditor","constructor","container","config","loadingOverlay","showLoading","createLoadingOverlay","loadingText","extendedConfig","super","value","__publicField","this","isLoading","progress","message","pluginManager","PluginManager","getInstance","themeManager","ThemeManager","featureManager","EditorFeatureManager","asyncInit","updateLoadingState","waitForEditor","setupMonacoWorkers","workers","language","configureLanguageDefaults","preloadLanguages","tabSize","getDefaultTabSize","getEditor","updateOptions","initializeThemes","plugins","loadByConfig","snippets","registerCommonSnippets","recommendedPlugins","getRecommendedPlugins","length","loadPlugins","initializeFeatures","applyPerformanceOptimizations","configureFormatting","configureValidation","configureKeybindings","_isInitialized","onInitialized","setTimeout","hideLoading","error","onError","Promise","resolve","checkEditor","themeConfig","themes","custom","forEach","name","data","registerTheme","followSystem","theme","applySystemTheme","onThemeChange","watchSystemTheme","default","setTheme","editor","setEditor","features","configureFeatures","multiCursor","enableMultiCursor","bracketMatching","enableSmartBrackets","folding","enhanceFolding","find","enableEnhancedFind","smartSelect","enableSmartSelect","columnSelection","enableColumnSelection","minimap","enhanceMinimap","addCustomKeybindings","addContextMenuItems","perfConfig","performance","options","virtualScrolling","smoothScrolling","largeFileOptimizations","largeFileThreshold","model","getModel","getValue","renderWhitespace","renderControlCharacters","fontLigatures","enabled","syntaxHighlightCache","useShadowDOM","formatConfig","formatting","formatOnType","formatOnPaste","formatOnSave","validationConfig","validation","keybindingsConfig","keybindings","key","command","when","scheme","loadingState","progressBar","querySelector","messageEl","style","width","textContent","onLoadingChange","opacity","remove","getAvailableThemes","getFeatureManager","getThemeManager","getPluginManager","setLanguageByFilename","filename","getLanguageByExtension","setLanguage","isInitialized","getStats","getEditorStats","createDiffEditor","original","modified","dispose","getLoadingState","customText","overlay","document","createElement","className","innerHTML","position","appendChild","createEnhancedCodeEditor","element","Error"],"mappings":"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"}