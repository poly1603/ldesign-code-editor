{"version":3,"file":"TabManager.js","sources":["../../../src/features/filesystem/TabManager.ts"],"sourcesContent":["/**\n * 标签页管理器\n */\n\nimport type { TabInfo, FileNode } from '../../types/filesystem'\n\nexport class TabManager {\n  private tabs: TabInfo[] = []\n  private activeTabId: string | null = null\n  private callbacks = new Set<(tabs: TabInfo[]) => void>()\n\n  openTab(file: FileNode, content: string): TabInfo {\n    const existing = this.tabs.find((t) => t.file.path === file.path)\n    if (existing) {\n      this.setActiveTab(existing.id)\n      return existing\n    }\n\n    const tab: TabInfo = {\n      id: this.generateId(),\n      file,\n      active: true,\n      dirty: false,\n      content,\n    }\n\n    this.tabs.forEach((t) => (t.active = false))\n    this.tabs.push(tab)\n    this.activeTabId = tab.id\n    this.notifyChange()\n    return tab\n  }\n\n  closeTab(tabId: string): void {\n    const index = this.tabs.findIndex((t) => t.id === tabId)\n    if (index !== -1) {\n      this.tabs.splice(index, 1)\n      if (this.activeTabId === tabId && this.tabs.length > 0) {\n        this.setActiveTab(this.tabs[Math.max(0, index - 1)].id)\n      }\n      this.notifyChange()\n    }\n  }\n\n  setActiveTab(tabId: string): void {\n    this.tabs.forEach((t) => (t.active = t.id === tabId))\n    this.activeTabId = tabId\n    this.notifyChange()\n  }\n\n  getActiveTab(): TabInfo | null {\n    return this.tabs.find((t) => t.active) || null\n  }\n\n  getAllTabs(): TabInfo[] {\n    return [...this.tabs]\n  }\n\n  markDirty(tabId: string, dirty = true): void {\n    const tab = this.tabs.find((t) => t.id === tabId)\n    if (tab) {\n      tab.dirty = dirty\n      this.notifyChange()\n    }\n  }\n\n  onChange(callback: (tabs: TabInfo[]) => void): () => void {\n    this.callbacks.add(callback)\n    return () => this.callbacks.delete(callback)\n  }\n\n  private notifyChange(): void {\n    this.callbacks.forEach((cb) => cb(this.tabs))\n  }\n\n  private generateId(): string {\n    return `tab-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n  }\n}\n\n"],"names":["TabManager","constructor","__publicField","this","Set","openTab","file","content","existing","tabs","find","t","path","setActiveTab","id","tab","generateId","active","dirty","forEach","push","activeTabId","notifyChange","closeTab","tabId","index","findIndex","splice","length","Math","max","getActiveTab","getAllTabs","markDirty","onChange","callback","callbacks","add","delete","cb","Date","now","random","toString","substr"],"mappings":"gKAMO,MAAMA,EAAN,WAAAC,GACLC,EAAAC,KAAQ,OAAkB,IAC1BD,EAAAC,KAAQ,cAA6B,MACrCD,EAAAC,KAAQ,YAAY,IAAIC,IAAA,CAExB,OAAAC,CAAQC,EAAgBC,GACtB,MAAMC,EAAWL,KAAKM,KAAKC,KAAMC,GAAMA,EAAEL,KAAKM,OAASN,EAAKM,MAC5D,GAAIJ,EACF,OAAAL,KAAKU,aAAaL,EAASM,IACpBN,EAGT,MAAMO,EAAe,CACnBD,GAAIX,KAAKa,aACTV,KAAAA,EACAW,QAAQ,EACRC,OAAO,EACPX,QAAAA,GAGF,YAAKE,KAAKU,QAASR,GAAOA,EAAEM,QAAS,GACrCd,KAAKM,KAAKW,KAAKL,GACfZ,KAAKkB,YAAcN,EAAID,GACvBX,KAAKmB,eACEP,CACT,CAEA,QAAAQ,CAASC,GACP,MAAMC,EAAQtB,KAAKM,KAAKiB,UAAWf,GAAMA,EAAEG,KAAOU,IACpC,IAAVC,IACFtB,KAAKM,KAAKkB,OAAOF,EAAO,GACpBtB,KAAKkB,cAAgBG,GAASrB,KAAKM,KAAKmB,OAAS,GACnDzB,KAAKU,aAAaV,KAAKM,KAAKoB,KAAKC,IAAI,EAAGL,EAAQ,IAAIX,IAEtDX,KAAKmB,eAET,CAEA,YAAAT,CAAaW,GACXrB,KAAKM,KAAKU,QAASR,GAAOA,EAAEM,OAASN,EAAEG,KAAOU,GAC9CrB,KAAKkB,YAAcG,EACnBrB,KAAKmB,cACP,CAEA,YAAAS,GACE,OAAO5B,KAAKM,KAAKC,KAAMC,GAAMA,EAAEM,SAAW,IAC5C,CAEA,UAAAe,GACE,MAAO,IAAI7B,KAAKM,KAClB,CAEA,SAAAwB,CAAUT,EAAeN,GAAQ,GAC/B,MAAMH,EAAMZ,KAAKM,KAAKC,KAAMC,GAAMA,EAAEG,KAAOU,GACvCT,IACFA,EAAIG,MAAQA,EACZf,KAAKmB,eAET,CAEA,QAAAY,CAASC,GACP,YAAKC,UAAUC,IAAIF,GACZ,IAAMhC,KAAKiC,UAAUE,OAAOH,EACrC,CAEQ,YAAAb,GACNnB,KAAKiC,UAAUjB,QAASoB,GAAOA,EAAGpC,KAAKM,MACzC,CAEQ,UAAAO,GACN,MAAO,OAAOwB,KAAKC,SAASZ,KAAKa,SAASC,SAAS,IAAIC,OAAO,EAAG,IACnE"}