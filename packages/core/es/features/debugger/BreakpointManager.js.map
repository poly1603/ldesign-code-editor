{"version":3,"file":"BreakpointManager.js","sources":["../../../src/features/debugger/BreakpointManager.ts"],"sourcesContent":["/**\n * 断点管理器\n */\n\nimport type { Breakpoint } from '../../types/debugger'\nimport type * as Monaco from 'monaco-editor'\n\nexport class BreakpointManager {\n  private breakpoints = new Map<number, Breakpoint>()\n  private decorations: string[] = []\n  private editor: Monaco.editor.IStandaloneCodeEditor | null = null\n\n  setEditor(editor: Monaco.editor.IStandaloneCodeEditor): void {\n    this.editor = editor\n    this.renderBreakpoints()\n  }\n\n  addBreakpoint(line: number, condition?: string): Breakpoint {\n    const bp: Breakpoint = {\n      id: `bp-${Date.now()}`,\n      line,\n      enabled: true,\n      condition,\n      hitCount: 0,\n    }\n    this.breakpoints.set(line, bp)\n    this.renderBreakpoints()\n    return bp\n  }\n\n  removeBreakpoint(line: number): void {\n    this.breakpoints.delete(line)\n    this.renderBreakpoints()\n  }\n\n  toggleBreakpoint(line: number): void {\n    if (this.breakpoints.has(line)) {\n      this.removeBreakpoint(line)\n    } else {\n      this.addBreakpoint(line)\n    }\n  }\n\n  enableBreakpoint(line: number, enabled = true): void {\n    const bp = this.breakpoints.get(line)\n    if (bp) {\n      bp.enabled = enabled\n      this.renderBreakpoints()\n    }\n  }\n\n  getBreakpoints(): Breakpoint[] {\n    return Array.from(this.breakpoints.values())\n  }\n\n  clearAll(): void {\n    this.breakpoints.clear()\n    this.renderBreakpoints()\n  }\n\n  private renderBreakpoints(): void {\n    if (!this.editor) return\n\n    const monaco = (globalThis as { monaco?: typeof Monaco }).monaco\n    if (!monaco) return\n\n    const newDecorations = Array.from(this.breakpoints.values()).map((bp) => ({\n      range: new monaco.Range(bp.line, 1, bp.line, 1),\n      options: {\n        isWholeLine: true,\n        className: bp.enabled ? 'breakpoint-line' : 'breakpoint-disabled-line',\n        glyphMarginClassName: bp.enabled ? 'breakpoint-glyph' : 'breakpoint-disabled-glyph',\n      },\n    }))\n\n    this.decorations = this.editor.deltaDecorations(this.decorations, newDecorations)\n  }\n}\n\n"],"names":["BreakpointManager","constructor","__publicField","this","Map","setEditor","editor","renderBreakpoints","addBreakpoint","line","condition","bp","id","Date","now","enabled","hitCount","breakpoints","set","removeBreakpoint","delete","toggleBreakpoint","has","enableBreakpoint","get","getBreakpoints","Array","from","values","clearAll","clear","monaco","globalThis","newDecorations","map","range","Range","options","isWholeLine","className","glyphMarginClassName","decorations","deltaDecorations"],"mappings":"gKAOO,MAAMA,EAAN,WAAAC,GACLC,EAAAC,KAAQ,cAAc,IAAIC,KAC1BF,EAAAC,KAAQ,cAAwB,IAChCD,EAAAC,KAAQ,SAAqD,MAE7D,SAAAE,CAAUC,GACRH,KAAKG,OAASA,EACdH,KAAKI,mBACP,CAEA,aAAAC,CAAcC,EAAcC,GAC1B,MAAMC,EAAiB,CACrBC,GAAI,MAAMC,KAAKC,QACfL,KAAAA,EACAM,SAAS,EACTL,UAAAA,EACAM,SAAU,GAEZ,OAAAb,KAAKc,YAAYC,IAAIT,EAAME,GAC3BR,KAAKI,oBACEI,CACT,CAEA,gBAAAQ,CAAiBV,GACfN,KAAKc,YAAYG,OAAOX,GACxBN,KAAKI,mBACP,CAEA,gBAAAc,CAAiBZ,GACXN,KAAKc,YAAYK,IAAIb,GACvBN,KAAKgB,iBAAiBV,GAEtBN,KAAKK,cAAcC,EAEvB,CAEA,gBAAAc,CAAiBd,EAAcM,GAAU,GACvC,MAAMJ,EAAKR,KAAKc,YAAYO,IAAIf,GAC5BE,IACFA,EAAGI,QAAUA,EACbZ,KAAKI,oBAET,CAEA,cAAAkB,GACE,OAAOC,MAAMC,KAAKxB,KAAKc,YAAYW,SACrC,CAEA,QAAAC,GACE1B,KAAKc,YAAYa,QACjB3B,KAAKI,mBACP,CAEQ,iBAAAA,GACN,IAAKJ,KAAKG,OAAQ,OAElB,MAAMyB,EAAUC,WAA0CD,OAC1D,IAAKA,EAAQ,OAEb,MAAME,EAAiBP,MAAMC,KAAKxB,KAAKc,YAAYW,UAAUM,IAAKvB,IAAAA,CAChEwB,MAAO,IAAIJ,EAAOK,MAAMzB,EAAGF,KAAM,EAAGE,EAAGF,KAAM,GAC7C4B,QAAS,CACPC,aAAa,EACbC,UAAW5B,EAAGI,QAAU,kBAAoB,2BAC5CyB,qBAAsB7B,EAAGI,QAAU,mBAAqB,gCAI5DZ,KAAKsC,YAActC,KAAKG,OAAOoC,iBAAiBvC,KAAKsC,YAAaR,EACpE"}