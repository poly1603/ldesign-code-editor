var e=Object.defineProperty,t=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);class s{constructor(e){t(this,"ws",null),t(this,"options"),t(this,"reconnectAttempts",0),t(this,"heartbeatTimer",null),t(this,"isIntentionallyClosed",!1),t(this,"messageQueue",[]),this.options={url:e.url,reconnectAttempts:e.reconnectAttempts||5,reconnectDelay:e.reconnectDelay||3e3,heartbeatInterval:e.heartbeatInterval||3e4,onOpen:e.onOpen||(()=>{}),onClose:e.onClose||(()=>{}),onError:e.onError||(()=>{}),onMessage:e.onMessage||(()=>{})}}connect(){return new Promise((e,t)=>{try{this.ws=new WebSocket(this.options.url),this.ws.onopen=()=>{this.reconnectAttempts=0,this.startHeartbeat(),this.flushMessageQueue(),this.options.onOpen(),e()},this.ws.onclose=e=>{this.stopHeartbeat(),this.options.onClose(),this.isIntentionallyClosed||this.attemptReconnect()},this.ws.onerror=e=>{const s=new Error("WebSocket connection error");this.options.onError(s),t(s)},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);this.options.onMessage(t)}catch(e){}}}catch(e){t(e)}})}send(e){this.isConnected()?this.ws.send(JSON.stringify(e)):this.messageQueue.push(e)}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}close(){this.isIntentionallyClosed=!0,this.stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Client closed connection"),this.ws=null)}attemptReconnect(){this.reconnectAttempts>=this.options.reconnectAttempts||(this.reconnectAttempts++,setTimeout(()=>{this.connect().catch(e=>{})},this.options.reconnectDelay*this.reconnectAttempts))}startHeartbeat(){this.heartbeatTimer=setInterval(()=>{this.isConnected()&&this.send({type:"presence",senderId:"",timestamp:Date.now(),data:{type:"heartbeat"}})},this.options.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}flushMessageQueue(){for(;this.messageQueue.length>0;){const e=this.messageQueue.shift();e&&this.send(e)}}getReadyState(){return this.ws?.readyState||WebSocket.CLOSED}getQueueSize(){return this.messageQueue.length}}export{s as WebSocketClient};
//# sourceMappingURL=WebSocketClient.js.map
