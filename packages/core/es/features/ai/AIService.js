var e=Object.defineProperty,t=(t,n,s)=>(((t,n,s)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s})(t,"symbol"!=typeof n?n+"":n,s),s);class n{constructor(e){t(this,"config"),t(this,"requestQueue",[]),t(this,"isProcessing",!1),t(this,"rateLimitDelay",1e3),this.config=e}updateConfig(e){this.config={...this.config,...e}}async getCompletion(e){return this.queueRequest(async()=>{try{const t=await this.makeAPIRequest("completions",{prompt:this.buildPrompt(e),max_tokens:e.maxTokens||this.config.maxTokens||100,temperature:e.temperature||this.config.temperature||.7,stop:e.stopSequences||["\n\n"]});return{completion:t.choices[0].text.trim(),confidence:"stop"===t.choices[0].finish_reason?.9:.7,alternatives:t.choices.slice(1).map(e=>e.text.trim()),metadata:{model:t.model,usage:t.usage}}}catch(e){throw this.handleError(e)}})}async naturalLanguageToCode(e){return this.queueRequest(async()=>{const t=this.buildNL2CodePrompt(e);try{return(await this.makeAPIRequest("completions",{prompt:t,max_tokens:200,temperature:.5})).choices[0].text.trim()}catch(e){throw this.handleError(e)}})}async explainCode(e,t){return this.queueRequest(async()=>{const n=`Explain the following ${t?.language||""} code:\n\n${e}\n\nProvide a clear explanation of what this code does:`;try{const t=(await this.makeAPIRequest("completions",{prompt:n,max_tokens:300,temperature:.3})).choices[0].text.trim();return{summary:t.split("\n")[0],details:t,complexity:this.assessComplexity(e),suggestions:this.extractSuggestions(t)}}catch(e){throw this.handleError(e)}})}async generateDocumentation(e,t){return this.queueRequest(async()=>{const n=`Generate JSDoc/documentation for the following ${t||""} code:\n\n${e}\n\nProvide comprehensive documentation:`;try{const e=(await this.makeAPIRequest("completions",{prompt:n,max_tokens:400,temperature:.3})).choices[0].text.trim();return this.parseDocumentation(e)}catch(e){throw this.handleError(e)}})}async fixCode(e,t,n){return this.queueRequest(async()=>{const s=`Fix the following ${n||""} code that has this error: "${t}"\n\nCode:\n${e}\n\nFixed code:`;try{return(await this.makeAPIRequest("completions",{prompt:s,max_tokens:300,temperature:.5})).choices[0].text.trim()}catch(e){throw this.handleError(e)}})}async optimizeCode(e,t){return this.queueRequest(async()=>{const n=`Optimize the following ${t||""} code for better performance and readability:\n\n${e}\n\nOptimized code:`;try{return(await this.makeAPIRequest("completions",{prompt:n,max_tokens:400,temperature:.5})).choices[0].text.trim()}catch(e){throw this.handleError(e)}})}async queueRequest(e){return new Promise((t,n)=>{this.requestQueue.push(async()=>{try{const n=await e();t(n)}catch(e){n(e)}}),this.processQueue()})}async processQueue(){if(!this.isProcessing&&0!==this.requestQueue.length){for(this.isProcessing=!0;this.requestQueue.length>0;){const e=this.requestQueue.shift();e&&(await e(),await this.delay(this.rateLimitDelay))}this.isProcessing=!1}}async makeAPIRequest(e,t){const n=this.buildURL(e),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.model||"gpt-3.5-turbo",...t}),signal:AbortSignal.timeout(this.config.timeout||3e4)});if(!s.ok)throw new Error(`API request failed: ${s.statusText}`);return await s.json()}buildURL(e){return`${this.config.baseURL||this.getDefaultBaseURL()}/${e}`}getDefaultBaseURL(){switch(this.config.provider){case"openai":return"https://api.openai.com/v1";case"claude":return"https://api.anthropic.com/v1";default:throw new Error("Unknown AI provider or missing baseURL")}}buildPrompt(e){let t="";return e.context&&(t+=`Context:\n${e.context}\n\n`),e.language&&(t+=`Language: ${e.language}\n\n`),t+=`Complete the following code:\n${e.prompt}`,t}buildNL2CodePrompt(e){let t=`Convert the following natural language description to ${e.targetLanguage||"JavaScript"} code:\n\n`;return t+=`"${e.query}"\n\n`,e.context&&(t+="Context:\n",t+=`File: ${e.context.fileName||"unknown"}\n`,t+=`Language: ${e.context.language||"unknown"}\n\n`),t+="Code:",t}assessComplexity(e){const t=e.split("\n").length,n=(e.match(/\{/g)||[]).length;return t<10&&n<3?"low":t<50&&n<10?"medium":"high"}extractSuggestions(e){const t=[],n=e.split("\n");for(const e of n)(e.includes("consider")||e.includes("should")||e.includes("could"))&&t.push(e.trim());return t}parseDocumentation(e){return{description:e.split("\n")[0]||"",parameters:[],examples:[],tags:[]}}handleError(e){return e instanceof Error?{code:"AI_ERROR",message:e.message,details:e}:{code:"UNKNOWN_ERROR",message:"An unknown error occurred",details:e}}delay(e){return new Promise(t=>setTimeout(t,e))}cancelAll(){this.requestQueue=[]}getQueueSize(){return this.requestQueue.length}}export{n as AIService};
//# sourceMappingURL=AIService.js.map
