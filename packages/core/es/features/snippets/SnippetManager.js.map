{"version":3,"file":"SnippetManager.js","sources":["../../../src/features/snippets/SnippetManager.ts"],"sourcesContent":["/**\n * 代码片段管理器\n */\n\nimport * as monaco from 'monaco-editor'\nimport { SnippetLibrary } from './SnippetLibrary'\nimport type { Snippet } from './SnippetLibrary'\n\nexport class SnippetManager {\n  private library = new SnippetLibrary()\n  private disposables: monaco.IDisposable[] = []\n\n  registerSnippets(language: string, snippets: Snippet[]): void {\n    snippets.forEach((s) => {\n      this.library.addSnippet({ ...s, language })\n    })\n\n    const disposable = monaco.languages.registerCompletionItemProvider(language, {\n      provideCompletionItems: (model, position) => {\n        const word = model.getWordUntilPosition(position)\n        const range = {\n          startLineNumber: position.lineNumber,\n          endLineNumber: position.lineNumber,\n          startColumn: word.startColumn,\n          endColumn: word.endColumn,\n        }\n\n        const languageSnippets = this.library.getSnippetsByLanguage(language)\n        const suggestions = languageSnippets.map((s) => ({\n          label: s.prefix,\n          kind: monaco.languages.CompletionItemKind.Snippet,\n          insertText: Array.isArray(s.body) ? s.body.join('\\n') : s.body,\n          insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\n          documentation: s.description || s.name,\n          range,\n        }))\n\n        return { suggestions }\n      },\n    })\n\n    this.disposables.push(disposable)\n  }\n\n  getLibrary(): SnippetLibrary {\n    return this.library\n  }\n\n  dispose(): void {\n    this.disposables.forEach((d) => d.dispose())\n    this.disposables = []\n  }\n}\n\n"],"names":["SnippetManager","constructor","__publicField","this","SnippetLibrary","registerSnippets","language","snippets","forEach","s","library","addSnippet","disposable","monaco","languages","registerCompletionItemProvider","provideCompletionItems","model","position","word","getWordUntilPosition","range","startLineNumber","lineNumber","endLineNumber","startColumn","endColumn","suggestions","getSnippetsByLanguage","map","label","prefix","kind","CompletionItemKind","Snippet","insertText","Array","isArray","body","join","insertTextRules","CompletionItemInsertTextRule","InsertAsSnippet","documentation","description","name","disposables","push","getLibrary","dispose","d"],"mappings":"qPAQO,MAAMA,EAAN,WAAAC,GACLC,EAAAC,KAAQ,UAAU,IAAIC,GACtBF,EAAAC,KAAQ,cAAoC,GAAC,CAE7C,gBAAAE,CAAiBC,EAAkBC,GACjCA,EAASC,QAASC,IAChBN,KAAKO,QAAQC,WAAW,IAAKF,EAAGH,SAAAA,MAGlC,MAAMM,EAAaC,EAAOC,UAAUC,+BAA+BT,EAAU,CAC3EU,uBAAwB,CAACC,EAAOC,KAC9B,MAAMC,EAAOF,EAAMG,qBAAqBF,GAClCG,EAAQ,CACZC,gBAAiBJ,EAASK,WAC1BC,cAAeN,EAASK,WACxBE,YAAaN,EAAKM,YAClBC,UAAWP,EAAKO,WAalB,MAAO,CAAEC,YAVgBxB,KAAKO,QAAQkB,sBAAsBtB,GACvBuB,IAAKpB,IAAAA,CACxCqB,MAAOrB,EAAEsB,OACTC,KAAMnB,EAAOC,UAAUmB,mBAAmBC,QAC1CC,WAAYC,MAAMC,QAAQ5B,EAAE6B,MAAQ7B,EAAE6B,KAAKC,KAAK,MAAQ9B,EAAE6B,KAC1DE,gBAAiB3B,EAAOC,UAAU2B,6BAA6BC,gBAC/DC,cAAelC,EAAEmC,aAAenC,EAAEoC,KAClCxB,MAAAA,SAONlB,KAAK2C,YAAYC,KAAKnC,EACxB,CAEA,UAAAoC,GACE,OAAO7C,KAAKO,OACd,CAEA,OAAAuC,GACE9C,KAAK2C,YAAYtC,QAAS0C,GAAMA,EAAED,WAClC9C,KAAK2C,YAAc,EACrB"}