{"version":3,"file":"debounce.js","sources":["../../src/utils/debounce.ts"],"sourcesContent":["/**\n * 防抖和节流工具函数\n */\n\n/**\n * 防抖函数\n * @param func 要防抖的函数\n * @param wait 等待时间（毫秒）\n * @param immediate 是否立即执行\n */\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  func: T,\n  wait = 300,\n  immediate = false\n): (...args: Parameters<T>) => void {\n  let timeout: ReturnType<typeof setTimeout> | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): void {\n    const later = () => {\n      timeout = null\n      if (!immediate) {\n        func.apply(this, args)\n      }\n    }\n\n    const callNow = immediate && !timeout\n\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    timeout = setTimeout(later, wait)\n\n    if (callNow) {\n      func.apply(this, args)\n    }\n  }\n}\n\n/**\n * 节流函数\n * @param func 要节流的函数\n * @param limit 限制时间（毫秒）\n * @param options 选项\n */\nexport function throttle<T extends (...args: unknown[]) => unknown>(\n  func: T,\n  limit = 100,\n  options: { leading?: boolean; trailing?: boolean } = {}\n): (...args: Parameters<T>) => void {\n  const { leading = true, trailing = true } = options\n  let inThrottle = false\n  let lastFunc: ReturnType<typeof setTimeout> | null = null\n  let lastRan: number | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): void {\n    if (!inThrottle) {\n      if (leading) {\n        func.apply(this, args)\n      }\n      lastRan = Date.now()\n      inThrottle = true\n\n      setTimeout(() => {\n        inThrottle = false\n      }, limit)\n    } else if (trailing) {\n      if (lastFunc) {\n        clearTimeout(lastFunc)\n      }\n\n      lastFunc = setTimeout(() => {\n        if (lastRan && Date.now() - lastRan >= limit) {\n          func.apply(this, args)\n          lastRan = Date.now()\n        }\n      }, limit - (Date.now() - (lastRan || 0)))\n    }\n  }\n}\n\n/**\n * RequestAnimationFrame 节流\n * @param func 要节流的函数\n */\nexport function rafThrottle<T extends (...args: unknown[]) => unknown>(\n  func: T\n): (...args: Parameters<T>) => void {\n  let rafId: number | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): void {\n    if (rafId !== null) {\n      return\n    }\n\n    rafId = requestAnimationFrame(() => {\n      func.apply(this, args)\n      rafId = null\n    })\n  }\n}\n\n/**\n * 批量处理函数\n * @param func 要批量处理的函数\n * @param wait 等待时间（毫秒）\n */\nexport function batchProcess<T>(\n  func: (items: T[]) => void,\n  wait = 100\n): (item: T) => void {\n  let items: T[] = []\n  let timeout: ReturnType<typeof setTimeout> | null = null\n\n  return function executedFunction(item: T): void {\n    items.push(item)\n\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    timeout = setTimeout(() => {\n      func(items)\n      items = []\n      timeout = null\n    }, wait)\n  }\n}\n\n/**\n * 异步防抖\n * @param func 异步函数\n * @param wait 等待时间（毫秒）\n */\nexport function asyncDebounce<T extends (...args: unknown[]) => Promise<unknown>>(\n  func: T,\n  wait = 300\n): (...args: Parameters<T>) => Promise<ReturnType<T>> {\n  let timeout: ReturnType<typeof setTimeout> | null = null\n  let pendingPromise: Promise<ReturnType<T>> | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): Promise<ReturnType<T>> {\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    if (!pendingPromise) {\n      pendingPromise = new Promise((resolve) => {\n        timeout = setTimeout(async () => {\n          const result = await func.apply(this, args)\n          resolve(result as ReturnType<T>)\n          pendingPromise = null\n          timeout = null\n        }, wait)\n      })\n    }\n\n    return pendingPromise\n  }\n}\n\n/**\n * 延迟执行\n * @param ms 延迟时间（毫秒）\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\n/**\n * 超时控制\n * @param promise 要控制的 Promise\n * @param timeout 超时时间（毫秒）\n * @param errorMessage 超时错误消息\n */\nexport function withTimeout<T>(\n  promise: Promise<T>,\n  timeout: number,\n  errorMessage = 'Operation timed out'\n): Promise<T> {\n  return Promise.race([\n    promise,\n    new Promise<T>((_, reject) =>\n      setTimeout(() => reject(new Error(errorMessage)), timeout)\n    ),\n  ])\n}\n\n/**\n * 重试函数\n * @param func 要重试的函数\n * @param retries 重试次数\n * @param delayMs 重试间隔（毫秒）\n */\nexport async function retry<T>(\n  func: () => Promise<T>,\n  retries = 3,\n  delayMs = 1000\n): Promise<T> {\n  let lastError: Error | null = null\n\n  for (let i = 0; i <= retries; i++) {\n    try {\n      return await func()\n    } catch (error) {\n      lastError = error as Error\n      if (i < retries) {\n        await delay(delayMs * (i + 1)) // 指数退避\n      }\n    }\n  }\n\n  throw lastError || new Error('Retry failed')\n}\n\n"],"names":["debounce","func","wait","immediate","timeout","args","callNow","clearTimeout","setTimeout","apply","this","throttle","limit","options","leading","trailing","inThrottle","lastFunc","lastRan","Date","now","rafThrottle","rafId","requestAnimationFrame","batchProcess","items","item","push","asyncDebounce","pendingPromise","Promise","resolve","async","result","delay","ms","withTimeout","promise","errorMessage","race","_","reject","Error","retry","retries","delayMs","lastError","i","error"],"mappings":"AAUO,SAASA,EACdC,EACAC,EAAO,IACPC,GAAY,GAEZ,IAAIC,EAAgD,KAEpD,OAAO,YAA4CC,GACjD,MAOMC,EAAUH,IAAcC,EAE1BA,GACFG,aAAaH,GAGfA,EAAUI,WAbI,KACZJ,EAAU,KACLD,GACHF,EAAKQ,MAAMC,KAAML,IAUOH,GAExBI,GACFL,EAAKQ,MAAMC,KAAML,EAErB,CACF,UAQgBM,EACdV,EACAW,EAAQ,IACRC,EAAqD,CAAA,GAErD,MAAQC,QAAAA,GAAU,EAAMC,SAAAA,GAAW,GAASF,EAC5C,IAAIG,GAAa,EACbC,EAAiD,KACjDC,EAAyB,KAE7B,OAAO,YAA4Cb,GAC5CW,EAUMD,IACLE,GACFV,aAAaU,GAGfA,EAAWT,WAAW,KAChBU,GAAWC,KAAKC,MAAQF,GAAWN,IACrCX,EAAKQ,MAAMC,KAAML,GACjBa,EAAUC,KAAKC,QAEhBR,GAASO,KAAKC,OAASF,GAAW,OAnBjCJ,GACFb,EAAKQ,MAAMC,KAAML,GAEnBa,EAAUC,KAAKC,MACfJ,GAAa,EAEbR,WAAW,KACTQ,GAAa,GACZJ,GAaP,CACF,CAMO,SAASS,EACdpB,GAEA,IAAIqB,EAAuB,KAE3B,OAAO,YAA4CjB,GACnC,OAAViB,IAIJA,EAAQC,sBAAsB,KAC5BtB,EAAKQ,MAAMC,KAAML,GACjBiB,EAAQ,OAEZ,CACF,CAOO,SAASE,EACdvB,EACAC,EAAO,KAEP,IAAIuB,EAAa,GACbrB,EAAgD,KAEpD,OAAO,SAA0BsB,GAC/BD,EAAME,KAAKD,GAEPtB,GACFG,aAAaH,GAGfA,EAAUI,WAAW,KACnBP,EAAKwB,GACLA,EAAQ,GACRrB,EAAU,MACTF,EACL,CACF,CAOO,SAAS0B,EACd3B,EACAC,EAAO,KAEP,IAAIE,EAAgD,KAChDyB,EAAgD,KAEpD,OAAO,YAA4CxB,GACjD,OAAID,GACFG,aAAaH,GAGVyB,IACHA,EAAiB,IAAIC,QAASC,IAC5B3B,EAAUI,WAAWwB,UACnB,MAAMC,QAAehC,EAAKQ,MAAMC,KAAML,GACtC0B,EAAQE,GACRJ,EAAiB,KACjBzB,EAAU,MACTF,MAIA2B,CACT,CACF,CAMO,SAASK,EAAMC,GACpB,OAAO,IAAIL,QAASC,GAAYvB,WAAWuB,EAASI,GACtD,UAQgBC,EACdC,EACAjC,EACAkC,EAAe,uBAEf,OAAOR,QAAQS,KAAK,CAClBF,EACA,IAAIP,QAAW,CAACU,EAAGC,IACjBjC,WAAW,IAAMiC,EAAO,IAAIC,MAAMJ,IAAgBlC,KAGxD,CAQA4B,eAAsBW,EACpB1C,EACA2C,EAAU,EACVC,EAAU,KAEV,IAAIC,EAA0B,KAE9B,IAAA,IAASC,EAAI,EAAGA,GAAKH,EAASG,IAC5B,IACE,aAAa9C,GACf,CAAA,MAAS+C,GACPF,EAAYE,EACRD,EAAIH,SACAV,EAAMW,GAAWE,EAAI,GAE/B,CAGF,MAAMD,GAAa,IAAIJ,MAAM,eAC/B"}