{"version":3,"file":"plugins.js","sources":["../../src/utils/plugins.ts"],"sourcesContent":["/**\r\n * 编辑器插件系统\r\n */\r\n\r\nimport * as monaco from 'monaco-editor'\r\nimport type { PluginConfig } from '../types'\r\nimport { registerEmmetProvider, configureEmmet, registerEmmetForCustomLanguages } from './emmet'\r\nimport { registerVueLanguage, registerReactLanguage, addReactTypes, addVueTypes } from './languages'\r\nimport { setupTypeScriptDefaults, setupJavaScriptDefaults } from './workers'\r\n\r\n/**\r\n * 插件管理器\r\n */\r\nexport class PluginManager {\r\n  private static instance: PluginManager\r\n  private loadedPlugins: Set<string> = new Set()\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): PluginManager {\r\n    if (!PluginManager.instance) {\r\n      PluginManager.instance = new PluginManager()\r\n    }\r\n    return PluginManager.instance\r\n  }\r\n\r\n  /**\r\n   * 加载插件\r\n   */\r\n  async loadPlugin(name: string, _config: PluginConfig = {}): Promise<void> {\r\n    if (this.loadedPlugins.has(name)) {\r\n      return\r\n    }\r\n\r\n    switch (name) {\r\n      case 'emmet':\r\n        await this.loadEmmetPlugin()\r\n        break\r\n      case 'vue':\r\n        await this.loadVuePlugin()\r\n        break\r\n      case 'react':\r\n        await this.loadReactPlugin()\r\n        break\r\n      case 'typescript':\r\n        await this.loadTypeScriptPlugin()\r\n        break\r\n      default:\r\n        console.warn(`Unknown plugin: ${name}`)\r\n    }\r\n\r\n    this.loadedPlugins.add(name)\r\n  }\r\n\r\n  /**\r\n   * 批量加载插件\r\n   */\r\n  async loadPlugins(plugins: string[], config: PluginConfig = {}): Promise<void> {\r\n    const promises = plugins.map(plugin => this.loadPlugin(plugin, config))\r\n    await Promise.all(promises)\r\n  }\r\n\r\n  /**\r\n   * 根据配置加载插件\r\n   */\r\n  async loadByConfig(config: PluginConfig): Promise<void> {\r\n    const plugins: string[] = []\r\n\r\n    if (config.emmet) {\r\n      plugins.push('emmet')\r\n    }\r\n\r\n    if (config.snippets !== false) {\r\n      // snippets 默认启用\r\n      // monaco 自带代码片段功能\r\n    }\r\n\r\n    await this.loadPlugins(plugins, config)\r\n  }\r\n\r\n  /**\r\n   * 检查插件是否已加载\r\n   */\r\n  isPluginLoaded(name: string): boolean {\r\n    return this.loadedPlugins.has(name)\r\n  }\r\n\r\n  /**\r\n   * 加载 Emmet 插件\r\n   */\r\n  private async loadEmmetPlugin(): Promise<void> {\r\n    registerEmmetProvider()\r\n    configureEmmet()\r\n  }\r\n\r\n  /**\r\n   * 加载 Vue 插件\r\n   */\r\n  private async loadVuePlugin(): Promise<void> {\r\n    registerVueLanguage()\r\n    await addVueTypes()\r\n    // 在语言注册后为 Vue 注册 Emmet\r\n    registerEmmetForCustomLanguages(['vue'])\r\n  }\r\n\r\n  /**\r\n   * 加载 React 插件\r\n   */\r\n  private async loadReactPlugin(): Promise<void> {\r\n    registerReactLanguage()\r\n    await addReactTypes()\r\n    // 为 TSX/JSX 注册 Emmet\r\n    registerEmmetForCustomLanguages(['typescriptreact', 'javascriptreact'])\r\n  }\r\n\r\n  /**\r\n   * 加载 TypeScript 插件\r\n   */\r\n  private async loadTypeScriptPlugin(): Promise<void> {\r\n    setupTypeScriptDefaults()\r\n    setupJavaScriptDefaults()\r\n  }\r\n}\r\n\r\n/**\r\n * 常用代码片段\r\n */\r\nexport function registerCommonSnippets() {\r\n  // JavaScript/TypeScript 代码片段\r\n  monaco.languages.registerCompletionItemProvider('javascript', {\r\n    provideCompletionItems: (model, position) => {\r\n      const word = model.getWordUntilPosition(position)\r\n      const range = {\r\n        startLineNumber: position.lineNumber,\r\n        endLineNumber: position.lineNumber,\r\n        startColumn: word.startColumn,\r\n        endColumn: word.endColumn\r\n      }\r\n\r\n      return {\r\n        suggestions: [\r\n          {\r\n            label: 'log',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'console.log(${1:value});',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '输出到控制台',\r\n            range\r\n          },\r\n          {\r\n            label: 'func',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'function ${1:name}(${2:params}) {\\n\\t${0}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建函数',\r\n            range\r\n          },\r\n          {\r\n            label: 'arrow',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'const ${1:name} = (${2:params}) => {\\n\\t${0}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建箭头函数',\r\n            range\r\n          },\r\n          {\r\n            label: 'foreach',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: '${1:array}.forEach((${2:item}) => {\\n\\t${0}\\n});',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: 'forEach 循环',\r\n            range\r\n          },\r\n          {\r\n            label: 'map',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: '${1:array}.map((${2:item}) => ${0})',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: 'map 映射',\r\n            range\r\n          },\r\n          {\r\n            label: 'filter',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: '${1:array}.filter((${2:item}) => ${0})',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: 'filter 过滤',\r\n            range\r\n          },\r\n          {\r\n            label: 'reduce',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: '${1:array}.reduce((${2:acc}, ${3:item}) => {\\n\\t${0}\\n}, ${4:initial})',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: 'reduce 归约',\r\n            range\r\n          },\r\n          {\r\n            label: 'promise',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'new Promise((resolve, reject) => {\\n\\t${0}\\n})',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建 Promise',\r\n            range\r\n          },\r\n          {\r\n            label: 'async',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'async function ${1:name}(${2:params}) {\\n\\t${0}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建异步函数',\r\n            range\r\n          },\r\n          {\r\n            label: 'try',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'try {\\n\\t${1}\\n} catch (error) {\\n\\t${0}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: 'try-catch 错误处理',\r\n            range\r\n          },\r\n        ]\r\n      }\r\n    }\r\n  })\r\n\r\n  // TypeScript 代码片段\r\n  monaco.languages.registerCompletionItemProvider('typescript', {\r\n    provideCompletionItems: (model, position) => {\r\n      const word = model.getWordUntilPosition(position)\r\n      const range = {\r\n        startLineNumber: position.lineNumber,\r\n        endLineNumber: position.lineNumber,\r\n        startColumn: word.startColumn,\r\n        endColumn: word.endColumn\r\n      }\r\n\r\n      return {\r\n        suggestions: [\r\n          {\r\n            label: 'interface',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'interface ${1:Name} {\\n\\t${0}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建接口',\r\n            range\r\n          },\r\n          {\r\n            label: 'type',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'type ${1:Name} = ${0}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建类型别名',\r\n            range\r\n          },\r\n          {\r\n            label: 'class',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'class ${1:Name} {\\n\\tconstructor(${2:params}) {\\n\\t\\t${0}\\n\\t}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建类',\r\n            range\r\n          },\r\n          {\r\n            label: 'enum',\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: 'enum ${1:Name} {\\n\\t${0}\\n}',\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: '创建枚举',\r\n            range\r\n          },\r\n        ]\r\n      }\r\n    }\r\n  })\r\n}\r\n"],"names":["_PluginManager","constructor","__publicField","this","Set","getInstance","instance","loadPlugin","name","_config","loadedPlugins","has","loadEmmetPlugin","loadVuePlugin","loadReactPlugin","loadTypeScriptPlugin","add","loadPlugins","plugins","config","promises","map","plugin","Promise","all","loadByConfig","emmet","push","snippets","isPluginLoaded","registerEmmetProvider","configureEmmet","registerVueLanguage","addVueTypes","registerEmmetForCustomLanguages","registerReactLanguage","addReactTypes","setupTypeScriptDefaults","setupJavaScriptDefaults","PluginManager","registerCommonSnippets","monaco","languages","registerCompletionItemProvider","provideCompletionItems","model","position","word","getWordUntilPosition","range","startLineNumber","lineNumber","endLineNumber","startColumn","endColumn","suggestions","label","kind","CompletionItemKind","Snippet","insertText","insertTextRules","CompletionItemInsertTextRule","InsertAsSnippet","documentation"],"mappings":"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"}