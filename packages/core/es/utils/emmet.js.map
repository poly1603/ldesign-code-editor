{"version":3,"file":"emmet.js","sources":["../../src/utils/emmet.ts"],"sourcesContent":["/**\r\n * Emmet 代码补全支持\r\n */\r\n\r\nimport * as monaco from 'monaco-editor'\r\n\r\n/**\r\n * 注册 Emmet 补全提供器\r\n */\r\nexport function registerEmmetProvider() {\r\n  // 只为 Monaco Editor 原生支持的语言注册 Emmet\r\n  const emmetLanguages = ['html', 'css', 'scss', 'less']\r\n\r\n  emmetLanguages.forEach(language => {\r\n    // 注册补全提供器\r\n    monaco.languages.registerCompletionItemProvider(language, {\r\n      triggerCharacters: ['>'],\r\n      provideCompletionItems: (model, position) => {\r\n        const lineContent = model.getLineContent(position.lineNumber)\r\n        const textBeforeCursor = lineContent.substring(0, position.column - 1)\r\n\r\n        // 简单的 Emmet 缩写检测\r\n        const emmetMatch = textBeforeCursor.match(/[\\w\\.\\#\\[\\]\\(\\)\\*\\+\\>\\^]+$/)\r\n\r\n        if (!emmetMatch) {\r\n          return { suggestions: [] }\r\n        }\r\n\r\n        const abbreviation = emmetMatch[0]\r\n        const suggestions = expandEmmetAbbreviation(abbreviation, language)\r\n\r\n        return {\r\n          suggestions: suggestions.map(item => ({\r\n            label: item.label,\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: item.insertText,\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: item.documentation,\r\n            range: {\r\n              startLineNumber: position.lineNumber,\r\n              startColumn: position.column - abbreviation.length,\r\n              endLineNumber: position.lineNumber,\r\n              endColumn: position.column\r\n            }\r\n          }))\r\n        }\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 展开 Emmet 缩写\r\n */\r\nfunction expandEmmetAbbreviation(abbreviation: string, language: string): Array<{\r\n  label: string\r\n  insertText: string\r\n  documentation: string\r\n}> {\r\n  const suggestions: Array<{ label: string; insertText: string; documentation: string }> = []\r\n\r\n  // HTML/Vue Emmet 缩写\r\n  if (['html', 'vue'].includes(language)) {\r\n    const htmlExpansions: Record<string, { snippet: string; doc: string }> = {\r\n      'div': {\r\n        snippet: '<div>$0</div>',\r\n        doc: '创建 div 元素'\r\n      },\r\n      'p': {\r\n        snippet: '<p>$0</p>',\r\n        doc: '创建 p 元素'\r\n      },\r\n      'span': {\r\n        snippet: '<span>$0</span>',\r\n        doc: '创建 span 元素'\r\n      },\r\n      'a': {\r\n        snippet: '<a href=\"$1\">$0</a>',\r\n        doc: '创建 a 链接元素'\r\n      },\r\n      'img': {\r\n        snippet: '<img src=\"$1\" alt=\"$2\">',\r\n        doc: '创建 img 图片元素'\r\n      },\r\n      'ul>li': {\r\n        snippet: '<ul>\\n\\t<li>$0</li>\\n</ul>',\r\n        doc: '创建无序列表'\r\n      },\r\n      'ol>li': {\r\n        snippet: '<ol>\\n\\t<li>$0</li>\\n</ol>',\r\n        doc: '创建有序列表'\r\n      },\r\n      'table': {\r\n        snippet: '<table>\\n\\t<tr>\\n\\t\\t<td>$0</td>\\n\\t</tr>\\n</table>',\r\n        doc: '创建表格'\r\n      },\r\n      'form': {\r\n        snippet: '<form action=\"$1\">\\n\\t$0\\n</form>',\r\n        doc: '创建表单'\r\n      },\r\n      'input': {\r\n        snippet: '<input type=\"$1\" name=\"$2\" value=\"$3\">',\r\n        doc: '创建输入框'\r\n      },\r\n      'button': {\r\n        snippet: '<button type=\"$1\">$0</button>',\r\n        doc: '创建按钮'\r\n      },\r\n      'h1': {\r\n        snippet: '<h1>$0</h1>',\r\n        doc: '创建 h1 标题'\r\n      },\r\n      'h2': {\r\n        snippet: '<h2>$0</h2>',\r\n        doc: '创建 h2 标题'\r\n      },\r\n      'h3': {\r\n        snippet: '<h3>$0</h3>',\r\n        doc: '创建 h3 标题'\r\n      },\r\n    }\r\n\r\n    // 类选择器\r\n    if (abbreviation.includes('.')) {\r\n      const parts = abbreviation.split('.')\r\n      const tag = parts[0] || 'div'\r\n      const classes = parts.slice(1).join(' ')\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: `<${tag} class=\"${classes}\">$0</${tag}>`,\r\n        documentation: `创建带有 class=\"${classes}\" 的 ${tag} 元素`\r\n      })\r\n    }\r\n    // ID 选择器\r\n    else if (abbreviation.includes('#')) {\r\n      const parts = abbreviation.split('#')\r\n      const tag = parts[0] || 'div'\r\n      const id = parts[1]\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: `<${tag} id=\"${id}\">$0</${tag}>`,\r\n        documentation: `创建带有 id=\"${id}\" 的 ${tag} 元素`\r\n      })\r\n    }\r\n    // 标准缩写\r\n    else if (htmlExpansions[abbreviation]) {\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: htmlExpansions[abbreviation].snippet,\r\n        documentation: htmlExpansions[abbreviation].doc\r\n      })\r\n    }\r\n  }\r\n\r\n  // CSS Emmet 缩写\r\n  if (['css', 'scss', 'less'].includes(language)) {\r\n    const cssExpansions: Record<string, { snippet: string; doc: string }> = {\r\n      'm': {\r\n        snippet: 'margin: $0;',\r\n        doc: '设置外边距'\r\n      },\r\n      'p': {\r\n        snippet: 'padding: $0;',\r\n        doc: '设置内边距'\r\n      },\r\n      'w': {\r\n        snippet: 'width: $0;',\r\n        doc: '设置宽度'\r\n      },\r\n      'h': {\r\n        snippet: 'height: $0;',\r\n        doc: '设置高度'\r\n      },\r\n      'd': {\r\n        snippet: 'display: $0;',\r\n        doc: '设置显示模式'\r\n      },\r\n      'df': {\r\n        snippet: 'display: flex;',\r\n        doc: '设置为弹性布局'\r\n      },\r\n      'dg': {\r\n        snippet: 'display: grid;',\r\n        doc: '设置为网格布局'\r\n      },\r\n      'dn': {\r\n        snippet: 'display: none;',\r\n        doc: '隐藏元素'\r\n      },\r\n      'db': {\r\n        snippet: 'display: block;',\r\n        doc: '设置为块级元素'\r\n      },\r\n      'di': {\r\n        snippet: 'display: inline;',\r\n        doc: '设置为内联元素'\r\n      },\r\n      'dib': {\r\n        snippet: 'display: inline-block;',\r\n        doc: '设置为内联块元素'\r\n      },\r\n      'pos': {\r\n        snippet: 'position: $0;',\r\n        doc: '设置定位'\r\n      },\r\n      'posa': {\r\n        snippet: 'position: absolute;',\r\n        doc: '设置绝对定位'\r\n      },\r\n      'posr': {\r\n        snippet: 'position: relative;',\r\n        doc: '设置相对定位'\r\n      },\r\n      'posf': {\r\n        snippet: 'position: fixed;',\r\n        doc: '设置固定定位'\r\n      },\r\n      'fz': {\r\n        snippet: 'font-size: $0;',\r\n        doc: '设置字体大小'\r\n      },\r\n      'fw': {\r\n        snippet: 'font-weight: $0;',\r\n        doc: '设置字体粗细'\r\n      },\r\n      'c': {\r\n        snippet: 'color: $0;',\r\n        doc: '设置颜色'\r\n      },\r\n      'bg': {\r\n        snippet: 'background: $0;',\r\n        doc: '设置背景'\r\n      },\r\n      'bgc': {\r\n        snippet: 'background-color: $0;',\r\n        doc: '设置背景颜色'\r\n      },\r\n      'bd': {\r\n        snippet: 'border: $0;',\r\n        doc: '设置边框'\r\n      },\r\n      'br': {\r\n        snippet: 'border-radius: $0;',\r\n        doc: '设置圆角'\r\n      },\r\n      'ta': {\r\n        snippet: 'text-align: $0;',\r\n        doc: '设置文本对齐'\r\n      },\r\n      'tac': {\r\n        snippet: 'text-align: center;',\r\n        doc: '文本居中'\r\n      },\r\n    }\r\n\r\n    if (cssExpansions[abbreviation]) {\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: cssExpansions[abbreviation].snippet,\r\n        documentation: cssExpansions[abbreviation].doc\r\n      })\r\n    }\r\n  }\r\n\r\n  return suggestions\r\n}\r\n\r\n/**\r\n * 为自定义语言注册 Emmet 支持（在语言注册之后调用）\r\n */\r\nexport function registerEmmetForCustomLanguages(languages: string[]) {\r\n  languages.forEach(language => {\r\n    try {\r\n      // 注册补全提供器\r\n      monaco.languages.registerCompletionItemProvider(language, {\r\n        triggerCharacters: ['>'],\r\n        provideCompletionItems: (model, position) => {\r\n          const lineContent = model.getLineContent(position.lineNumber)\r\n          const textBeforeCursor = lineContent.substring(0, position.column - 1)\r\n\r\n          // 简单的 Emmet 缩写检测\r\n          const emmetMatch = textBeforeCursor.match(/[\\w\\.\\#\\[\\]\\(\\)\\*\\+\\>\\^]+$/)\r\n\r\n          if (!emmetMatch) {\r\n            return { suggestions: [] }\r\n          }\r\n\r\n          const abbreviation = emmetMatch[0]\r\n          const suggestions = expandEmmetAbbreviation(abbreviation, language)\r\n\r\n          return {\r\n            suggestions: suggestions.map(item => ({\r\n              label: item.label,\r\n              kind: monaco.languages.CompletionItemKind.Snippet,\r\n              insertText: item.insertText,\r\n              insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n              documentation: item.documentation,\r\n              range: {\r\n                startLineNumber: position.lineNumber,\r\n                startColumn: position.column - abbreviation.length,\r\n                endLineNumber: position.lineNumber,\r\n                endColumn: position.column\r\n              }\r\n            }))\r\n          }\r\n        }\r\n      })\r\n\r\n      // 配置自动闭合\r\n      monaco.languages.setLanguageConfiguration(language, {\r\n        autoClosingPairs: [\r\n          { open: '{', close: '}' },\r\n          { open: '[', close: ']' },\r\n          { open: '(', close: ')' },\r\n          { open: '\"', close: '\"' },\r\n          { open: \"'\", close: \"'\" },\r\n          { open: '<', close: '>' },\r\n          { open: '`', close: '`' }\r\n        ]\r\n      })\r\n    } catch (e) {\r\n      console.debug(`Failed to register Emmet for language ${language}:`, e)\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * 配置 Emmet 行为\r\n */\r\nexport function configureEmmet() {\r\n  // 为支持 Emmet 的语言设置自动补全触发字符\r\n  // 只配置 Monaco Editor 原生支持的语言\r\n  const emmetLanguages = ['html', 'css', 'scss', 'less']\r\n\r\n  emmetLanguages.forEach(language => {\r\n    try {\r\n      monaco.languages.setLanguageConfiguration(language, {\r\n        autoClosingPairs: [\r\n          { open: '{', close: '}' },\r\n          { open: '[', close: ']' },\r\n          { open: '(', close: ')' },\r\n          { open: '\"', close: '\"' },\r\n          { open: \"'\", close: \"'\" },\r\n          { open: '<', close: '>' },\r\n          { open: '`', close: '`' }\r\n        ]\r\n      })\r\n    } catch (e) {\r\n      // 语言不存在，忽略\r\n      console.debug(`Language ${language} not registered, skipping Emmet config`)\r\n    }\r\n  })\r\n}\r\n"],"names":["registerEmmetProvider","forEach","language","monaco","languages","registerCompletionItemProvider","triggerCharacters","provideCompletionItems","model","position","emmetMatch","getLineContent","lineNumber","substring","column","match","suggestions","abbreviation","expandEmmetAbbreviation","map","item","label","kind","CompletionItemKind","Snippet","insertText","insertTextRules","CompletionItemInsertTextRule","InsertAsSnippet","documentation","range","startLineNumber","startColumn","length","endLineNumber","endColumn","includes","htmlExpansions","div","snippet","doc","p","span","a","img","table","form","input","button","h1","h2","h3","parts","split","tag","classes","slice","join","push","id","cssExpansions","m","w","h","d","df","dg","dn","db","di","dib","pos","posa","posr","posf","fz","fw","c","bg","bgc","bd","br","ta","tac","registerEmmetForCustomLanguages","setLanguageConfiguration","autoClosingPairs","open","close","e","configureEmmet"],"mappings":"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"}