{"version":3,"file":"emmet.cjs","sources":["../../src/utils/emmet.ts"],"sourcesContent":["/**\r\n * Emmet 代码补全支持\r\n */\r\n\r\nimport * as monaco from 'monaco-editor'\r\n\r\n/**\r\n * 注册 Emmet 补全提供器\r\n */\r\nexport function registerEmmetProvider() {\r\n  // 只为 Monaco Editor 原生支持的语言注册 Emmet\r\n  const emmetLanguages = ['html', 'css', 'scss', 'less']\r\n\r\n  emmetLanguages.forEach(language => {\r\n    // 注册补全提供器\r\n    monaco.languages.registerCompletionItemProvider(language, {\r\n      triggerCharacters: ['>'],\r\n      provideCompletionItems: (model, position) => {\r\n        const lineContent = model.getLineContent(position.lineNumber)\r\n        const textBeforeCursor = lineContent.substring(0, position.column - 1)\r\n\r\n        // 简单的 Emmet 缩写检测\r\n        const emmetMatch = textBeforeCursor.match(/[\\w\\.\\#\\[\\]\\(\\)\\*\\+\\>\\^]+$/)\r\n\r\n        if (!emmetMatch) {\r\n          return { suggestions: [] }\r\n        }\r\n\r\n        const abbreviation = emmetMatch[0]\r\n        const suggestions = expandEmmetAbbreviation(abbreviation, language)\r\n\r\n        return {\r\n          suggestions: suggestions.map(item => ({\r\n            label: item.label,\r\n            kind: monaco.languages.CompletionItemKind.Snippet,\r\n            insertText: item.insertText,\r\n            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n            documentation: item.documentation,\r\n            range: {\r\n              startLineNumber: position.lineNumber,\r\n              startColumn: position.column - abbreviation.length,\r\n              endLineNumber: position.lineNumber,\r\n              endColumn: position.column\r\n            }\r\n          }))\r\n        }\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 展开 Emmet 缩写\r\n */\r\nfunction expandEmmetAbbreviation(abbreviation: string, language: string): Array<{\r\n  label: string\r\n  insertText: string\r\n  documentation: string\r\n}> {\r\n  const suggestions: Array<{ label: string; insertText: string; documentation: string }> = []\r\n\r\n  // HTML/Vue Emmet 缩写\r\n  if (['html', 'vue'].includes(language)) {\r\n    const htmlExpansions: Record<string, { snippet: string; doc: string }> = {\r\n      'div': {\r\n        snippet: '<div>$0</div>',\r\n        doc: '创建 div 元素'\r\n      },\r\n      'p': {\r\n        snippet: '<p>$0</p>',\r\n        doc: '创建 p 元素'\r\n      },\r\n      'span': {\r\n        snippet: '<span>$0</span>',\r\n        doc: '创建 span 元素'\r\n      },\r\n      'a': {\r\n        snippet: '<a href=\"$1\">$0</a>',\r\n        doc: '创建 a 链接元素'\r\n      },\r\n      'img': {\r\n        snippet: '<img src=\"$1\" alt=\"$2\">',\r\n        doc: '创建 img 图片元素'\r\n      },\r\n      'ul>li': {\r\n        snippet: '<ul>\\n\\t<li>$0</li>\\n</ul>',\r\n        doc: '创建无序列表'\r\n      },\r\n      'ol>li': {\r\n        snippet: '<ol>\\n\\t<li>$0</li>\\n</ol>',\r\n        doc: '创建有序列表'\r\n      },\r\n      'table': {\r\n        snippet: '<table>\\n\\t<tr>\\n\\t\\t<td>$0</td>\\n\\t</tr>\\n</table>',\r\n        doc: '创建表格'\r\n      },\r\n      'form': {\r\n        snippet: '<form action=\"$1\">\\n\\t$0\\n</form>',\r\n        doc: '创建表单'\r\n      },\r\n      'input': {\r\n        snippet: '<input type=\"$1\" name=\"$2\" value=\"$3\">',\r\n        doc: '创建输入框'\r\n      },\r\n      'button': {\r\n        snippet: '<button type=\"$1\">$0</button>',\r\n        doc: '创建按钮'\r\n      },\r\n      'h1': {\r\n        snippet: '<h1>$0</h1>',\r\n        doc: '创建 h1 标题'\r\n      },\r\n      'h2': {\r\n        snippet: '<h2>$0</h2>',\r\n        doc: '创建 h2 标题'\r\n      },\r\n      'h3': {\r\n        snippet: '<h3>$0</h3>',\r\n        doc: '创建 h3 标题'\r\n      },\r\n    }\r\n\r\n    // 类选择器\r\n    if (abbreviation.includes('.')) {\r\n      const parts = abbreviation.split('.')\r\n      const tag = parts[0] || 'div'\r\n      const classes = parts.slice(1).join(' ')\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: `<${tag} class=\"${classes}\">$0</${tag}>`,\r\n        documentation: `创建带有 class=\"${classes}\" 的 ${tag} 元素`\r\n      })\r\n    }\r\n    // ID 选择器\r\n    else if (abbreviation.includes('#')) {\r\n      const parts = abbreviation.split('#')\r\n      const tag = parts[0] || 'div'\r\n      const id = parts[1]\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: `<${tag} id=\"${id}\">$0</${tag}>`,\r\n        documentation: `创建带有 id=\"${id}\" 的 ${tag} 元素`\r\n      })\r\n    }\r\n    // 标准缩写\r\n    else if (htmlExpansions[abbreviation]) {\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: htmlExpansions[abbreviation].snippet,\r\n        documentation: htmlExpansions[abbreviation].doc\r\n      })\r\n    }\r\n  }\r\n\r\n  // CSS Emmet 缩写\r\n  if (['css', 'scss', 'less'].includes(language)) {\r\n    const cssExpansions: Record<string, { snippet: string; doc: string }> = {\r\n      'm': {\r\n        snippet: 'margin: $0;',\r\n        doc: '设置外边距'\r\n      },\r\n      'p': {\r\n        snippet: 'padding: $0;',\r\n        doc: '设置内边距'\r\n      },\r\n      'w': {\r\n        snippet: 'width: $0;',\r\n        doc: '设置宽度'\r\n      },\r\n      'h': {\r\n        snippet: 'height: $0;',\r\n        doc: '设置高度'\r\n      },\r\n      'd': {\r\n        snippet: 'display: $0;',\r\n        doc: '设置显示模式'\r\n      },\r\n      'df': {\r\n        snippet: 'display: flex;',\r\n        doc: '设置为弹性布局'\r\n      },\r\n      'dg': {\r\n        snippet: 'display: grid;',\r\n        doc: '设置为网格布局'\r\n      },\r\n      'dn': {\r\n        snippet: 'display: none;',\r\n        doc: '隐藏元素'\r\n      },\r\n      'db': {\r\n        snippet: 'display: block;',\r\n        doc: '设置为块级元素'\r\n      },\r\n      'di': {\r\n        snippet: 'display: inline;',\r\n        doc: '设置为内联元素'\r\n      },\r\n      'dib': {\r\n        snippet: 'display: inline-block;',\r\n        doc: '设置为内联块元素'\r\n      },\r\n      'pos': {\r\n        snippet: 'position: $0;',\r\n        doc: '设置定位'\r\n      },\r\n      'posa': {\r\n        snippet: 'position: absolute;',\r\n        doc: '设置绝对定位'\r\n      },\r\n      'posr': {\r\n        snippet: 'position: relative;',\r\n        doc: '设置相对定位'\r\n      },\r\n      'posf': {\r\n        snippet: 'position: fixed;',\r\n        doc: '设置固定定位'\r\n      },\r\n      'fz': {\r\n        snippet: 'font-size: $0;',\r\n        doc: '设置字体大小'\r\n      },\r\n      'fw': {\r\n        snippet: 'font-weight: $0;',\r\n        doc: '设置字体粗细'\r\n      },\r\n      'c': {\r\n        snippet: 'color: $0;',\r\n        doc: '设置颜色'\r\n      },\r\n      'bg': {\r\n        snippet: 'background: $0;',\r\n        doc: '设置背景'\r\n      },\r\n      'bgc': {\r\n        snippet: 'background-color: $0;',\r\n        doc: '设置背景颜色'\r\n      },\r\n      'bd': {\r\n        snippet: 'border: $0;',\r\n        doc: '设置边框'\r\n      },\r\n      'br': {\r\n        snippet: 'border-radius: $0;',\r\n        doc: '设置圆角'\r\n      },\r\n      'ta': {\r\n        snippet: 'text-align: $0;',\r\n        doc: '设置文本对齐'\r\n      },\r\n      'tac': {\r\n        snippet: 'text-align: center;',\r\n        doc: '文本居中'\r\n      },\r\n    }\r\n\r\n    if (cssExpansions[abbreviation]) {\r\n      suggestions.push({\r\n        label: abbreviation,\r\n        insertText: cssExpansions[abbreviation].snippet,\r\n        documentation: cssExpansions[abbreviation].doc\r\n      })\r\n    }\r\n  }\r\n\r\n  return suggestions\r\n}\r\n\r\n/**\r\n * 为自定义语言注册 Emmet 支持（在语言注册之后调用）\r\n */\r\nexport function registerEmmetForCustomLanguages(languages: string[]) {\r\n  languages.forEach(language => {\r\n    try {\r\n      // 注册补全提供器\r\n      monaco.languages.registerCompletionItemProvider(language, {\r\n        triggerCharacters: ['>'],\r\n        provideCompletionItems: (model, position) => {\r\n          const lineContent = model.getLineContent(position.lineNumber)\r\n          const textBeforeCursor = lineContent.substring(0, position.column - 1)\r\n\r\n          // 简单的 Emmet 缩写检测\r\n          const emmetMatch = textBeforeCursor.match(/[\\w\\.\\#\\[\\]\\(\\)\\*\\+\\>\\^]+$/)\r\n\r\n          if (!emmetMatch) {\r\n            return { suggestions: [] }\r\n          }\r\n\r\n          const abbreviation = emmetMatch[0]\r\n          const suggestions = expandEmmetAbbreviation(abbreviation, language)\r\n\r\n          return {\r\n            suggestions: suggestions.map(item => ({\r\n              label: item.label,\r\n              kind: monaco.languages.CompletionItemKind.Snippet,\r\n              insertText: item.insertText,\r\n              insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,\r\n              documentation: item.documentation,\r\n              range: {\r\n                startLineNumber: position.lineNumber,\r\n                startColumn: position.column - abbreviation.length,\r\n                endLineNumber: position.lineNumber,\r\n                endColumn: position.column\r\n              }\r\n            }))\r\n          }\r\n        }\r\n      })\r\n\r\n      // 配置自动闭合\r\n      monaco.languages.setLanguageConfiguration(language, {\r\n        autoClosingPairs: [\r\n          { open: '{', close: '}' },\r\n          { open: '[', close: ']' },\r\n          { open: '(', close: ')' },\r\n          { open: '\"', close: '\"' },\r\n          { open: \"'\", close: \"'\" },\r\n          { open: '<', close: '>' },\r\n          { open: '`', close: '`' }\r\n        ]\r\n      })\r\n    } catch (e) {\r\n      console.debug(`Failed to register Emmet for language ${language}:`, e)\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * 配置 Emmet 行为\r\n */\r\nexport function configureEmmet() {\r\n  // 为支持 Emmet 的语言设置自动补全触发字符\r\n  // 只配置 Monaco Editor 原生支持的语言\r\n  const emmetLanguages = ['html', 'css', 'scss', 'less']\r\n\r\n  emmetLanguages.forEach(language => {\r\n    try {\r\n      monaco.languages.setLanguageConfiguration(language, {\r\n        autoClosingPairs: [\r\n          { open: '{', close: '}' },\r\n          { open: '[', close: ']' },\r\n          { open: '(', close: ')' },\r\n          { open: '\"', close: '\"' },\r\n          { open: \"'\", close: \"'\" },\r\n          { open: '<', close: '>' },\r\n          { open: '`', close: '`' }\r\n        ]\r\n      })\r\n    } catch (e) {\r\n      // 语言不存在，忽略\r\n      console.debug(`Language ${language} not registered, skipping Emmet config`)\r\n    }\r\n  })\r\n}\r\n"],"names":["expandEmmetAbbreviation","abbreviation","language","suggestions","includes","htmlExpansions","div","snippet","doc","p","span","a","img","table","form","input","button","h1","h2","h3","parts","split","tag","classes","slice","join","push","label","insertText","documentation","id","cssExpansions","m","w","h","d","df","dg","dn","db","di","dib","pos","posa","posr","posf","fz","fw","c","bg","bgc","bd","br","ta","tac","forEach","monaco","languages","setLanguageConfiguration","autoClosingPairs","open","close","registerCompletionItemProvider","triggerCharacters","provideCompletionItems","model","position","emmetMatch","getLineContent","lineNumber","substring","column","match","map","item","kind","CompletionItemKind","Snippet","insertTextRules","CompletionItemInsertTextRule","InsertAsSnippet","range","startLineNumber","startColumn","length","endLineNumber","endColumn","e"],"mappings":"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"}