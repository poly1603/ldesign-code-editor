"use strict";var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);class s{constructor(t={}){e(this,"cache",new Map),e(this,"maxSize"),e(this,"ttl"),e(this,"onEvict"),this.maxSize=t.maxSize||100,this.ttl=t.ttl||1/0,this.onEvict=t.onEvict}get(t){const e=this.cache.get(t);if(e)return this.isExpired(e)?void this.delete(t):(e.hits++,e.timestamp=Date.now(),this.cache.delete(t),this.cache.set(t,e),e.value)}set(t,e){if(this.cache.has(t)&&this.cache.delete(t),this.cache.size>=this.maxSize){const t=this.cache.keys().next().value;t&&this.delete(t)}this.cache.set(t,{value:e,timestamp:Date.now(),hits:0})}delete(t){const e=this.cache.get(t);return e&&this.onEvict&&this.onEvict(t,e.value),this.cache.delete(t)}has(t){const e=this.cache.get(t);return!!e&&(!this.isExpired(e)||(this.delete(t),!1))}clear(){this.onEvict&&this.cache.forEach((t,e)=>{this.onEvict(e,t.value)}),this.cache.clear()}size(){return this.cache.size}keys(){return Array.from(this.cache.keys())}isExpired(t){return this.ttl!==1/0&&Date.now()-t.timestamp>this.ttl}cleanup(){let t=0;const e=Date.now();for(const[s,i]of this.cache.entries())e-i.timestamp>this.ttl&&(this.delete(s),t++);return t}getStats(){let t=0;const e=Array.from(this.cache.values());return e.forEach(e=>{t+=e.hits}),{size:this.cache.size,maxSize:this.maxSize,totalHits:t,averageHits:e.length>0?t/e.length:0}}}class i extends s{constructor(t={}){super(t),e(this,"cleanupInterval",null),t.cleanupInterval&&this.startCleanup(t.cleanupInterval)}startCleanup(t){this.cleanupInterval=setInterval(()=>{this.cleanup()},t)}stopCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}dispose(){this.stopCleanup(),this.clear()}}const a=new i({maxSize:500,ttl:3e5});exports.Cacheable=function(t={}){const e=new s(t);return function(t,s,i){const a=i.value;return i.value=function(...t){const s=JSON.stringify(t);if(e.has(s))return e.get(s);const i=a.apply(this,t);return i instanceof Promise?i.then(t=>(e.set(s,t),t)):(e.set(s,i),i)},i}},exports.LRUCache=s,exports.MemoryCache=i,exports.WeakCache=class{constructor(){e(this,"cache",new WeakMap)}get(t){return this.cache.get(t)}set(t,e){this.cache.set(t,e)}has(t){return this.cache.has(t)}delete(t){return this.cache.delete(t)}},exports.globalCache=a,exports.memoize=function(t,e){const s=new Map;return function(...i){const a=e?e(...i):JSON.stringify(i);if(s.has(a))return s.get(a);const c=t.apply(this,i);return s.set(a,c),c}};
//# sourceMappingURL=cache.cjs.map
