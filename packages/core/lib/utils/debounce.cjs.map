{"version":3,"file":"debounce.cjs","sources":["../../src/utils/debounce.ts"],"sourcesContent":["/**\n * 防抖和节流工具函数\n */\n\n/**\n * 防抖函数\n * @param func 要防抖的函数\n * @param wait 等待时间（毫秒）\n * @param immediate 是否立即执行\n */\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  func: T,\n  wait = 300,\n  immediate = false\n): (...args: Parameters<T>) => void {\n  let timeout: ReturnType<typeof setTimeout> | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): void {\n    const later = () => {\n      timeout = null\n      if (!immediate) {\n        func.apply(this, args)\n      }\n    }\n\n    const callNow = immediate && !timeout\n\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    timeout = setTimeout(later, wait)\n\n    if (callNow) {\n      func.apply(this, args)\n    }\n  }\n}\n\n/**\n * 节流函数\n * @param func 要节流的函数\n * @param limit 限制时间（毫秒）\n * @param options 选项\n */\nexport function throttle<T extends (...args: unknown[]) => unknown>(\n  func: T,\n  limit = 100,\n  options: { leading?: boolean; trailing?: boolean } = {}\n): (...args: Parameters<T>) => void {\n  const { leading = true, trailing = true } = options\n  let inThrottle = false\n  let lastFunc: ReturnType<typeof setTimeout> | null = null\n  let lastRan: number | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): void {\n    if (!inThrottle) {\n      if (leading) {\n        func.apply(this, args)\n      }\n      lastRan = Date.now()\n      inThrottle = true\n\n      setTimeout(() => {\n        inThrottle = false\n      }, limit)\n    } else if (trailing) {\n      if (lastFunc) {\n        clearTimeout(lastFunc)\n      }\n\n      lastFunc = setTimeout(() => {\n        if (lastRan && Date.now() - lastRan >= limit) {\n          func.apply(this, args)\n          lastRan = Date.now()\n        }\n      }, limit - (Date.now() - (lastRan || 0)))\n    }\n  }\n}\n\n/**\n * RequestAnimationFrame 节流\n * @param func 要节流的函数\n */\nexport function rafThrottle<T extends (...args: unknown[]) => unknown>(\n  func: T\n): (...args: Parameters<T>) => void {\n  let rafId: number | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): void {\n    if (rafId !== null) {\n      return\n    }\n\n    rafId = requestAnimationFrame(() => {\n      func.apply(this, args)\n      rafId = null\n    })\n  }\n}\n\n/**\n * 批量处理函数\n * @param func 要批量处理的函数\n * @param wait 等待时间（毫秒）\n */\nexport function batchProcess<T>(\n  func: (items: T[]) => void,\n  wait = 100\n): (item: T) => void {\n  let items: T[] = []\n  let timeout: ReturnType<typeof setTimeout> | null = null\n\n  return function executedFunction(item: T): void {\n    items.push(item)\n\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    timeout = setTimeout(() => {\n      func(items)\n      items = []\n      timeout = null\n    }, wait)\n  }\n}\n\n/**\n * 异步防抖\n * @param func 异步函数\n * @param wait 等待时间（毫秒）\n */\nexport function asyncDebounce<T extends (...args: unknown[]) => Promise<unknown>>(\n  func: T,\n  wait = 300\n): (...args: Parameters<T>) => Promise<ReturnType<T>> {\n  let timeout: ReturnType<typeof setTimeout> | null = null\n  let pendingPromise: Promise<ReturnType<T>> | null = null\n\n  return function executedFunction(this: unknown, ...args: Parameters<T>): Promise<ReturnType<T>> {\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    if (!pendingPromise) {\n      pendingPromise = new Promise((resolve) => {\n        timeout = setTimeout(async () => {\n          const result = await func.apply(this, args)\n          resolve(result as ReturnType<T>)\n          pendingPromise = null\n          timeout = null\n        }, wait)\n      })\n    }\n\n    return pendingPromise\n  }\n}\n\n/**\n * 延迟执行\n * @param ms 延迟时间（毫秒）\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\n/**\n * 超时控制\n * @param promise 要控制的 Promise\n * @param timeout 超时时间（毫秒）\n * @param errorMessage 超时错误消息\n */\nexport function withTimeout<T>(\n  promise: Promise<T>,\n  timeout: number,\n  errorMessage = 'Operation timed out'\n): Promise<T> {\n  return Promise.race([\n    promise,\n    new Promise<T>((_, reject) =>\n      setTimeout(() => reject(new Error(errorMessage)), timeout)\n    ),\n  ])\n}\n\n/**\n * 重试函数\n * @param func 要重试的函数\n * @param retries 重试次数\n * @param delayMs 重试间隔（毫秒）\n */\nexport async function retry<T>(\n  func: () => Promise<T>,\n  retries = 3,\n  delayMs = 1000\n): Promise<T> {\n  let lastError: Error | null = null\n\n  for (let i = 0; i <= retries; i++) {\n    try {\n      return await func()\n    } catch (error) {\n      lastError = error as Error\n      if (i < retries) {\n        await delay(delayMs * (i + 1)) // 指数退避\n      }\n    }\n  }\n\n  throw lastError || new Error('Retry failed')\n}\n\n"],"names":["delay","ms","Promise","resolve","setTimeout","func","wait","timeout","pendingPromise","args","clearTimeout","async","result","apply","this","items","item","push","immediate","callNow","rafId","requestAnimationFrame","retries","delayMs","lastError","i","error","Error","limit","options","leading","trailing","inThrottle","lastFunc","lastRan","Date","now","promise","errorMessage","race","_","reject"],"mappings":"aAqKO,SAASA,EAAMC,GACpB,OAAO,IAAIC,QAASC,GAAYC,WAAWD,EAASF,GACtD,uBAjCO,SACLI,EACAC,EAAO,KAEP,IAAIC,EAAgD,KAChDC,EAAgD,KAEpD,OAAO,YAA4CC,GACjD,OAAIF,GACFG,aAAaH,GAGVC,IACHA,EAAiB,IAAIN,QAASC,IAC5BI,EAAUH,WAAWO,UACnB,MAAMC,QAAeP,EAAKQ,MAAMC,KAAML,GACtCN,EAAQS,GACRJ,EAAiB,KACjBD,EAAU,MACTD,MAIAE,CACT,CACF,uBApDO,SACLH,EACAC,EAAO,KAEP,IAAIS,EAAa,GACbR,EAAgD,KAEpD,OAAO,SAA0BS,GAC/BD,EAAME,KAAKD,GAEPT,GACFG,aAAaH,GAGfA,EAAUH,WAAW,KACnBC,EAAKU,GACLA,EAAQ,GACRR,EAAU,MACTD,EACL,CACF,mBArHO,SACLD,EACAC,EAAO,IACPY,GAAY,GAEZ,IAAIX,EAAgD,KAEpD,OAAO,YAA4CE,GACjD,MAOMU,EAAUD,IAAcX,EAE1BA,GACFG,aAAaH,GAGfA,EAAUH,WAbI,KACZG,EAAU,KACLW,GACHb,EAAKQ,MAAMC,KAAML,IAUOH,GAExBa,GACFd,EAAKQ,MAAMC,KAAML,EAErB,CACF,sCAgDO,SACLJ,GAEA,IAAIe,EAAuB,KAE3B,OAAO,YAA4CX,GACnC,OAAVW,IAIJA,EAAQC,sBAAsB,KAC5BhB,EAAKQ,MAAMC,KAAML,GACjBW,EAAQ,OAEZ,CACF,gBA8FAT,eACEN,EACAiB,EAAU,EACVC,EAAU,KAEV,IAAIC,EAA0B,KAE9B,IAAA,IAASC,EAAI,EAAGA,GAAKH,EAASG,IAC5B,IACE,aAAapB,GACf,CAAA,MAASqB,GACPF,EAAYE,EACRD,EAAIH,SACAtB,EAAMuB,GAAWE,EAAI,GAE/B,CAGF,MAAMD,GAAa,IAAIG,MAAM,eAC/B,4BAvKEtB,EACAuB,EAAQ,IACRC,EAAqD,CAAA,GAErD,MAAQC,QAAAA,GAAU,EAAMC,SAAAA,GAAW,GAASF,EAC5C,IAAIG,GAAa,EACbC,EAAiD,KACjDC,EAAyB,KAE7B,OAAO,YAA4CzB,GAC5CuB,EAUMD,IACLE,GACFvB,aAAauB,GAGfA,EAAW7B,WAAW,KAChB8B,GAAWC,KAAKC,MAAQF,GAAWN,IACrCvB,EAAKQ,MAAMC,KAAML,GACjByB,EAAUC,KAAKC,QAEhBR,GAASO,KAAKC,OAASF,GAAW,OAnBjCJ,GACFzB,EAAKQ,MAAMC,KAAML,GAEnByB,EAAUC,KAAKC,MACfJ,GAAa,EAEb5B,WAAW,KACT4B,GAAa,GACZJ,GAaP,CACF,+BAiGES,EACA9B,EACA+B,EAAe,uBAEf,OAAOpC,QAAQqC,KAAK,CAClBF,EACA,IAAInC,QAAW,CAACsC,EAAGC,IACjBrC,WAAW,IAAMqC,EAAO,IAAId,MAAMW,IAAgB/B,KAGxD"}