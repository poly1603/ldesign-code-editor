{"version":3,"file":"ExtensionSandbox.cjs","sources":["../../src/core/ExtensionSandbox.ts"],"sourcesContent":["/**\n * 扩展沙箱环境\n */\n\nexport class ExtensionSandbox {\n  private iframe: HTMLIFrameElement | null = null\n\n  createSandbox(): HTMLIFrameElement {\n    this.iframe = document.createElement('iframe')\n    this.iframe.style.display = 'none'\n    this.iframe.sandbox.add('allow-scripts')\n    document.body.appendChild(this.iframe)\n    return this.iframe\n  }\n\n  async executeInSandbox(code: string): Promise<unknown> {\n    if (!this.iframe || !this.iframe.contentWindow) {\n      throw new Error('Sandbox not initialized')\n    }\n\n    return new Promise((resolve, reject) => {\n      const handler = (event: MessageEvent) => {\n        if (event.source === this.iframe?.contentWindow) {\n          window.removeEventListener('message', handler)\n          if (event.data.error) {\n            reject(new Error(event.data.error))\n          } else {\n            resolve(event.data.result)\n          }\n        }\n      }\n\n      window.addEventListener('message', handler)\n\n      this.iframe.contentWindow.postMessage({ code }, '*')\n    })\n  }\n\n  destroy(): void {\n    if (this.iframe) {\n      this.iframe.remove()\n      this.iframe = null\n    }\n  }\n}\n\n"],"names":["constructor","__publicField","this","createSandbox","iframe","document","createElement","style","display","sandbox","add","body","appendChild","executeInSandbox","code","contentWindow","Error","Promise","resolve","reject","handler","event","source","window","removeEventListener","data","error","result","addEventListener","postMessage","destroy","remove"],"mappings":"iLAIO,MAAA,WAAAA,GACLC,EAAAC,KAAQ,SAAmC,KAAA,CAE3C,aAAAC,GACE,OAAAD,KAAKE,OAASC,SAASC,cAAc,UACrCJ,KAAKE,OAAOG,MAAMC,QAAU,OAC5BN,KAAKE,OAAOK,QAAQC,IAAI,iBACxBL,SAASM,KAAKC,YAAYV,KAAKE,QACxBF,KAAKE,MACd,CAEA,sBAAMS,CAAiBC,GACrB,IAAKZ,KAAKE,SAAWF,KAAKE,OAAOW,cAC/B,MAAM,IAAIC,MAAM,2BAGlB,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAWC,IACXA,EAAMC,SAAWpB,KAAKE,QAAQW,gBAChCQ,OAAOC,oBAAoB,UAAWJ,GAClCC,EAAMI,KAAKC,MACbP,EAAO,IAAIH,MAAMK,EAAMI,KAAKC,QAE5BR,EAAQG,EAAMI,KAAKE,UAKzBJ,OAAOK,iBAAiB,UAAWR,GAEnClB,KAAKE,OAAOW,cAAcc,YAAY,CAAEf,KAAAA,GAAQ,MAEpD,CAEA,OAAAgB,GACM5B,KAAKE,SACPF,KAAKE,OAAO2B,SACZ7B,KAAKE,OAAS,KAElB"}