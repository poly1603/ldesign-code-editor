{"version":3,"file":"DependencyInjection.cjs","sources":["../../src/core/DependencyInjection.ts"],"sourcesContent":["/**\n * 依赖注入容器\n * 实现服务注册、解析和生命周期管理\n */\n\nexport type ServiceLifetime = 'singleton' | 'transient' | 'scoped'\n\nexport interface ServiceDescriptor<T = unknown> {\n  token: symbol | string\n  factory: (container: DIContainer) => T\n  lifetime: ServiceLifetime\n  instance?: T\n}\n\n/**\n * 依赖注入容器类\n */\nexport class DIContainer {\n  private services = new Map<symbol | string, ServiceDescriptor>()\n  private scopedInstances = new Map<symbol | string, unknown>()\n\n  /**\n   * 注册服务\n   */\n  register<T>(\n    token: symbol | string,\n    factory: (container: DIContainer) => T,\n    lifetime: ServiceLifetime = 'singleton'\n  ): void {\n    this.services.set(token, {\n      token,\n      factory,\n      lifetime,\n    })\n  }\n\n  /**\n   * 注册单例服务\n   */\n  registerSingleton<T>(token: symbol | string, factory: (container: DIContainer) => T): void {\n    this.register(token, factory, 'singleton')\n  }\n\n  /**\n   * 注册瞬时服务\n   */\n  registerTransient<T>(token: symbol | string, factory: (container: DIContainer) => T): void {\n    this.register(token, factory, 'transient')\n  }\n\n  /**\n   * 注册作用域服务\n   */\n  registerScoped<T>(token: symbol | string, factory: (container: DIContainer) => T): void {\n    this.register(token, factory, 'scoped')\n  }\n\n  /**\n   * 解析服务\n   */\n  resolve<T>(token: symbol | string): T {\n    const descriptor = this.services.get(token)\n\n    if (!descriptor) {\n      throw new Error(`Service not found: ${String(token)}`)\n    }\n\n    switch (descriptor.lifetime) {\n      case 'singleton':\n        if (!descriptor.instance) {\n          descriptor.instance = descriptor.factory(this)\n        }\n        return descriptor.instance as T\n\n      case 'scoped':\n        if (!this.scopedInstances.has(token)) {\n          this.scopedInstances.set(token, descriptor.factory(this))\n        }\n        return this.scopedInstances.get(token) as T\n\n      case 'transient':\n        return descriptor.factory(this) as T\n\n      default:\n        throw new Error(`Unknown service lifetime: ${descriptor.lifetime}`)\n    }\n  }\n\n  /**\n   * 尝试解析服务\n   */\n  tryResolve<T>(token: symbol | string): T | null {\n    try {\n      return this.resolve<T>(token)\n    } catch {\n      return null\n    }\n  }\n\n  /**\n   * 检查服务是否已注册\n   */\n  has(token: symbol | string): boolean {\n    return this.services.has(token)\n  }\n\n  /**\n   * 清理作用域实例\n   */\n  clearScope(): void {\n    this.scopedInstances.clear()\n  }\n\n  /**\n   * 创建子容器\n   */\n  createScope(): DIContainer {\n    const scope = new DIContainer()\n    // 复制服务定义\n    this.services.forEach((descriptor, token) => {\n      scope.services.set(token, { ...descriptor })\n    })\n    return scope\n  }\n\n  /**\n   * 清理所有服务\n   */\n  dispose(): void {\n    this.services.clear()\n    this.scopedInstances.clear()\n  }\n}\n\n// 全局容器实例\nexport const globalContainer = new DIContainer()\n\n// 服务令牌\nexport const ServiceTokens = {\n  EditorCore: Symbol('EditorCore'),\n  PluginManager: Symbol('PluginManager'),\n  ThemeManager: Symbol('ThemeManager'),\n  FeatureManager: Symbol('FeatureManager'),\n  LanguageService: Symbol('LanguageService'),\n  AIService: Symbol('AIService'),\n  CollaborationService: Symbol('CollaborationService'),\n  FileSystemService: Symbol('FileSystemService'),\n  DebugService: Symbol('DebugService'),\n  SnippetManager: Symbol('SnippetManager'),\n  ExtensionLoader: Symbol('ExtensionLoader'),\n  PerformanceMonitor: Symbol('PerformanceMonitor'),\n  MemoryManager: Symbol('MemoryManager'),\n  CacheService: Symbol('CacheService'),\n} as const\n\n"],"names":["s","Object","defineProperty","t","i","e","r","enumerable","configurable","writable","value","o","DIContainer","constructor","__publicField","this","Map","register","token","factory","lifetime","services","set","registerSingleton","registerTransient","registerScoped","resolve","descriptor","get","Error","String","instance","scopedInstances","has","tryResolve","clearScope","clear","createScope","scope","forEach","dispose","globalContainer","ServiceTokens","EditorCore","Symbol","PluginManager","ThemeManager","FeatureManager","LanguageService","AIService","CollaborationService","FileSystemService","DebugService","SnippetManager","ExtensionLoader","PerformanceMonitor","MemoryManager","CacheService"],"mappings":"aAiBO,IAAAA,EAAAC,OAAAC,eAAAC,EAAA,CAAAC,EAAAC,EAAAC,KAAA,EAAAF,EAAAC,EAAAC,KAAAD,KAAAD,EAAAJ,EAAAI,EAAAC,EAAA,CAAAE,YAAA,EAAAC,cAAA,EAAAC,UAAA,EAAAC,MAAAJ,IAAAF,EAAAC,GAAAC,GAAAK,CAAAP,EAAA,iBAAAC,EAAAA,EAAA,GAAAA,EAAAC,GAAAA,GAAA,MAAMM,EAAN,WAAAC,GACLC,EAAAC,KAAQ,WAAW,IAAIC,KACvBF,EAAAC,KAAQ,kBAAkB,IAAIC,KAK9B,QAAAC,CACEC,EACAC,EACAC,EAA4B,aAE5BL,KAAKM,SAASC,IAAIJ,EAAO,CACvBA,MAAAA,EACAC,QAAAA,EACAC,SAAAA,GAEJ,CAKA,iBAAAG,CAAqBL,EAAwBC,GAC3CJ,KAAKE,SAASC,EAAOC,EAAS,YAChC,CAKA,iBAAAK,CAAqBN,EAAwBC,GAC3CJ,KAAKE,SAASC,EAAOC,EAAS,YAChC,CAKA,cAAAM,CAAkBP,EAAwBC,GACxCJ,KAAKE,SAASC,EAAOC,EAAS,SAChC,CAKA,OAAAO,CAAWR,GACT,MAAMS,EAAaZ,KAAKM,SAASO,IAAIV,GAErC,IAAKS,EACH,MAAM,IAAIE,MAAM,sBAAsBC,OAAOZ,MAG/C,OAAQS,EAAWP,UACjB,IAAK,YACH,OAAKO,EAAWI,WACdJ,EAAWI,SAAWJ,EAAWR,QAAQJ,OAEpCY,EAAWI,SAEpB,IAAK,SACH,OAAKhB,KAAKiB,gBAAgBC,IAAIf,IAC5BH,KAAKiB,gBAAgBV,IAAIJ,EAAOS,EAAWR,QAAQJ,OAE9CA,KAAKiB,gBAAgBJ,IAAIV,GAElC,IAAK,YACH,OAAOS,EAAWR,QAAQJ,MAE5B,QACE,MAAM,IAAIc,MAAM,6BAA6BF,EAAWP,YAE9D,CAKA,UAAAc,CAAchB,GACZ,IACE,OAAOH,KAAKW,QAAWR,EACzB,OACE,OAAO,IACT,CACF,CAKA,GAAAe,CAAIf,GACF,OAAOH,KAAKM,SAASY,IAAIf,EAC3B,CAKA,UAAAiB,GACEpB,KAAKiB,gBAAgBI,OACvB,CAKA,WAAAC,GACE,MAAMC,EAAQ,IAAI1B,EAElB,OAAAG,KAAKM,SAASkB,QAAQ,CAACZ,EAAYT,KACjCoB,EAAMjB,SAASC,IAAIJ,EAAO,IAAKS,MAE1BW,CACT,CAKA,OAAAE,GACEzB,KAAKM,SAASe,QACdrB,KAAKiB,gBAAgBI,OACvB,EAIK,MAAMK,EAAkB,IAAI7B,EAGtB8B,EAAgB,CAC3BC,WAAYC,OAAO,cACnBC,cAAeD,OAAO,iBACtBE,aAAcF,OAAO,gBACrBG,eAAgBH,OAAO,kBACvBI,gBAAiBJ,OAAO,mBACxBK,UAAWL,OAAO,aAClBM,qBAAsBN,OAAO,wBAC7BO,kBAAmBP,OAAO,qBAC1BQ,aAAcR,OAAO,gBACrBS,eAAgBT,OAAO,kBACvBU,gBAAiBV,OAAO,mBACxBW,mBAAoBX,OAAO,sBAC3BY,cAAeZ,OAAO,iBACtBa,aAAcb,OAAO"}