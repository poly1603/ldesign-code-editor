"use strict";var e=require("./CodeEditor.cjs"),t=require("../utils/workers.cjs"),n=require("../utils/plugins.cjs"),i=require("../utils/language-utils.cjs"),a=require("../utils/themes.cjs"),s=require("../utils/features.cjs"),r=Object.defineProperty,o=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class d extends e.CodeEditor{constructor(e,t={}){const i=!1!==t.showLoading?d.createLoadingOverlay(e,t.loadingText):null,r=t;super(e,{...t,value:t.value||""}),o(this,"loadingState",{isLoading:!1,progress:0,message:""}),o(this,"loadingOverlay",null),o(this,"pluginManager"),o(this,"themeManager"),o(this,"featureManager"),o(this,"extendedConfig"),o(this,"_isInitialized",!1),this.extendedConfig=r,this.pluginManager=n.PluginManager.getInstance(),this.themeManager=a.ThemeManager.getInstance(),this.featureManager=new s.EditorFeatureManager,this.loadingOverlay=i,this.asyncInit()}async asyncInit(){try{this.updateLoadingState(!0,10,"正在初始化编辑器核心..."),await this.waitForEditor(),this.updateLoadingState(!0,20,"正在配置 Monaco Editor Workers..."),t.setupMonacoWorkers(this.extendedConfig.workers),this.updateLoadingState(!0,30,"正在配置语言支持...");const e=this.extendedConfig.language||"javascript";i.configureLanguageDefaults(e),await t.preloadLanguages([e]);const a=this.extendedConfig.tabSize||i.getDefaultTabSize(e);this.getEditor()?.updateOptions({tabSize:a}),this.updateLoadingState(!0,40,"正在加载主题..."),await this.initializeThemes(),this.updateLoadingState(!0,50,"正在加载插件..."),this.extendedConfig.plugins&&await this.pluginManager.loadByConfig(this.extendedConfig.plugins),!1!==this.extendedConfig.plugins?.snippets&&n.registerCommonSnippets();const s=i.getRecommendedPlugins(e);s.length>0&&await this.pluginManager.loadPlugins(s),this.updateLoadingState(!0,70,"正在配置编辑器功能..."),await this.initializeFeatures(),this.updateLoadingState(!0,85,"正在优化性能设置..."),this.applyPerformanceOptimizations(),this.updateLoadingState(!0,95,"正在完成初始化..."),this.configureFormatting(),this.configureValidation(),this.configureKeybindings(),this.updateLoadingState(!0,100,"加载完成"),this._isInitialized=!0,this.extendedConfig.onInitialized&&this.extendedConfig.onInitialized(),setTimeout(()=>{this.hideLoading()},300)}catch(e){this.updateLoadingState(!1,0,"加载失败"),this.hideLoading(),this.extendedConfig.onError&&this.extendedConfig.onError(e)}}async waitForEditor(){return new Promise(e=>{const t=()=>{try{this.getEditor()?e():setTimeout(t,50)}catch{setTimeout(t,50)}};t()})}async initializeThemes(){const e=this.extendedConfig.themes;if(e)if(e.custom&&e.custom.forEach(({name:e,data:t})=>{this.themeManager.registerTheme(e,t)}),e.followSystem){const t=this.themeManager.applySystemTheme();e.onThemeChange&&e.onThemeChange(t),this.themeManager.watchSystemTheme(t=>{e.onThemeChange&&e.onThemeChange(t)})}else e.default&&this.setTheme(e.default)}async initializeFeatures(){const e=this.getEditor();e&&(this.featureManager.setEditor(e),this.extendedConfig.features&&this.featureManager.configureFeatures(this.extendedConfig.features),this.extendedConfig.features?.multiCursor&&this.featureManager.enableMultiCursor(),this.extendedConfig.features?.bracketMatching&&this.featureManager.enableSmartBrackets(),this.extendedConfig.features?.folding&&this.featureManager.enhanceFolding(),this.extendedConfig.features?.find&&this.featureManager.enableEnhancedFind(),this.extendedConfig.features?.smartSelect&&this.featureManager.enableSmartSelect(),this.extendedConfig.features?.columnSelection&&this.featureManager.enableColumnSelection(),this.extendedConfig.features?.minimap&&this.featureManager.enhanceMinimap(),this.featureManager.addCustomKeybindings(),this.featureManager.addContextMenuItems())}applyPerformanceOptimizations(){const e=this.extendedConfig.performance;if(!e)return;const t=this.getEditor();if(!t)return;const n={};if(void 0!==e.virtualScrolling&&(n.smoothScrolling=e.virtualScrolling),e.largeFileOptimizations&&(n.largeFileOptimizations=!0,e.largeFileThreshold)){const i=t.getModel();i&&i.getValue().length>e.largeFileThreshold&&(n.renderWhitespace="none",n.renderControlCharacters=!1,n.fontLigatures=!1,n.minimap={enabled:!1})}e.syntaxHighlightCache&&(n.useShadowDOM=!0),t.updateOptions(n)}configureFormatting(){const e=this.extendedConfig.formatting;if(!e)return;const t=this.getEditor();t&&(e.formatOnType&&t.updateOptions({formatOnType:!0}),e.formatOnPaste&&t.updateOptions({formatOnPaste:!0}),e.formatOnSave)}configureValidation(){const e=this.extendedConfig.validation;if(!e||!e.enabled)return;this.extendedConfig.language}configureKeybindings(){const e=this.extendedConfig.keybindings;!e||!this.getEditor()||(e.custom&&e.custom.forEach(({key:e,command:t,when:n})=>{}),e.scheme)}updateLoadingState(e,t,n){if(this.loadingState={isLoading:e,progress:t,message:n},this.loadingOverlay){const e=this.loadingOverlay.querySelector(".ld-loading-progress"),i=this.loadingOverlay.querySelector(".ld-loading-message");e&&(e.style.width=`${t}%`),i&&(i.textContent=n)}this.extendedConfig.onLoadingChange&&this.extendedConfig.onLoadingChange(this.loadingState)}hideLoading(){this.loadingOverlay&&(this.loadingOverlay.style.opacity="0",setTimeout(()=>{this.loadingOverlay?.remove(),this.loadingOverlay=null},300))}setTheme(e){super.setTheme(e);const t=this.extendedConfig.themes;t?.onThemeChange&&t.onThemeChange(e)}getAvailableThemes(){return this.themeManager.getAvailableThemes()}getFeatureManager(){return this.featureManager}getThemeManager(){return this.themeManager}getPluginManager(){return this.pluginManager}setLanguageByFilename(e){const t=i.getLanguageByExtension(e);this.setLanguage(t)}get isInitialized(){return this._isInitialized}getStats(){return this.featureManager.getEditorStats()}createDiffEditor(e,t,n,i){return this.featureManager.createDiffEditor(e,t,n,i)}dispose(){this.featureManager.dispose(),super.dispose()}getLoadingState(){return{...this.loadingState}}static createLoadingOverlay(e,t){const n=document.createElement("div");n.className="ld-editor-loading-overlay",n.innerHTML=`\n      <div class="ld-loading-spinner"></div>\n      <div class="ld-loading-message">${t||"正在初始化编辑器..."}</div>\n      <div class="ld-loading-progress-container">\n        <div class="ld-loading-progress"></div>\n      </div>\n    `;const i=document.createElement("style");return i.textContent="\n      .ld-editor-loading-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(30, 30, 30, 0.95);\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        z-index: 1000;\n        transition: opacity 0.3s ease;\n      }\n\n      .ld-loading-spinner {\n        width: 40px;\n        height: 40px;\n        border: 4px solid rgba(255, 255, 255, 0.1);\n        border-top-color: #667eea;\n        border-radius: 50%;\n        animation: ld-spin 0.8s linear infinite;\n      }\n\n      @keyframes ld-spin {\n        to { transform: rotate(360deg); }\n      }\n\n      .ld-loading-message {\n        margin-top: 20px;\n        color: #fff;\n        font-size: 14px;\n      }\n\n      .ld-loading-progress-container {\n        width: 200px;\n        height: 4px;\n        background: rgba(255, 255, 255, 0.1);\n        border-radius: 2px;\n        margin-top: 15px;\n        overflow: hidden;\n      }\n\n      .ld-loading-progress {\n        height: 100%;\n        background: linear-gradient(90deg, #667eea, #764ba2);\n        border-radius: 2px;\n        transition: width 0.3s ease;\n        width: 0%;\n      }\n    ",e.style.position="relative",e.appendChild(i),e.appendChild(n),n}}exports.EnhancedCodeEditor=d,exports.createEnhancedCodeEditor=function(e,t={}){const n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error("Container element not found");return new d(n,t)};
//# sourceMappingURL=EnhancedCodeEditor.cjs.map
