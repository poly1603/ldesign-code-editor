"use strict";var e=require("../utils/cache.cjs"),t=Object.defineProperty,a=(e,a,o)=>(((e,a,o)=>{a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o})(e,"symbol"!=typeof a?a+"":a,o),o);class o{constructor(){a(this,"cache",new e.LRUCache({maxSize:50})),a(this,"loading",new Map),a(this,"loaded",new Set)}async load(e,t,a={}){const{retries:o=3,timeout:s=1e4,cache:n=!0}=a;if(n&&this.cache.has(e))return this.cache.get(e);if(this.loading.has(e))return this.loading.get(e);const r=this.loadWithRetry(t,o,s);this.loading.set(e,r);try{const t=await r;return n&&this.cache.set(e,t),this.loaded.add(e),t}finally{this.loading.delete(e)}}async loadWithRetry(e,t,a){let o=null;for(let s=0;s<=t;s++)try{return await this.withTimeout(e(),a)}catch(e){o=e,s<t&&await this.delay(1e3*Math.pow(2,s))}throw o||new Error("Load failed after retries")}withTimeout(e,t){return Promise.race([e,new Promise((e,a)=>setTimeout(()=>a(new Error("Load timeout")),t))])}delay(e){return new Promise(t=>setTimeout(t,e))}isLoaded(e){return this.loaded.has(e)}async preload(e,t,a){this.isLoaded(e)||("requestIdleCallback"in window?window.requestIdleCallback(()=>{this.load(e,t,a).catch(e=>{})},{timeout:5e3}):setTimeout(()=>{this.load(e,t,a).catch(e=>{})},100))}async preloadBatch(e){const t=e.map(e=>this.preload(e.key,e.loader,e.options));await Promise.allSettled(t)}clearCache(){this.cache.clear()}reset(){this.cache.clear(),this.loading.clear(),this.loaded.clear()}getStats(){return{cached:this.cache.size(),loading:this.loading.size,loaded:this.loaded.size,cacheStats:this.cache.getStats()}}}class s extends o{async loadLanguage(e){const t=`language:${e}`;this.isLoaded(t)||await this.load(t,async()=>{switch(e){case"typescript":case"javascript":return Promise.resolve().then(function(){return require("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/typescript/monaco.contribution.cjs")});case"json":return Promise.resolve().then(function(){return require("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/json/monaco.contribution.cjs")});case"html":return Promise.resolve().then(function(){return require("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/html/monaco.contribution.cjs")});case"css":case"scss":case"less":return Promise.resolve().then(function(){return require("../node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/language/css/monaco.contribution.cjs")});default:return null}})}async preloadCommonLanguages(){await this.preloadBatch(["typescript","javascript","json","html","css"].map(e=>({key:`language:${e}`,loader:()=>this.loadLanguage(e)})))}}class n extends o{async loadTheme(e){const t=`theme:${e}`;return this.load(t,async()=>null)}}class r extends o{async loadPlugin(e){const t=`plugin:${e}`;return this.load(t,async()=>null)}}const i=new s,c=new n,l=new r;exports.LanguageLazyLoader=s,exports.LazyLoader=o,exports.PluginLazyLoader=r,exports.ThemeLazyLoader=n,exports.languageLoader=i,exports.pluginLoader=l,exports.themeLoader=c;
//# sourceMappingURL=LazyLoader.cjs.map
