{"version":3,"file":"ExtensionLoader.cjs","sources":["../../src/core/ExtensionLoader.ts"],"sourcesContent":["/**\n * 扩展加载器\n */\n\nimport type { Extension, ExtensionContext, ExtensionManifest } from '../types/extension'\n\nexport class ExtensionLoader {\n  private extensions = new Map<string, Extension>()\n  private activeExtensions = new Set<string>()\n\n  async loadExtension(manifest: ExtensionManifest): Promise<Extension> {\n    const extension: Extension = {\n      id: `${manifest.name}@${manifest.version}`,\n      name: manifest.name,\n      version: manifest.version,\n      main: manifest.main || manifest.browser || '',\n      contributes: manifest.contributes,\n    }\n\n    this.extensions.set(extension.id, extension)\n    return extension\n  }\n\n  async activateExtension(extensionId: string): Promise<void> {\n    const extension = this.extensions.get(extensionId)\n    if (!extension) {\n      throw new Error(`Extension not found: ${extensionId}`)\n    }\n\n    if (this.activeExtensions.has(extensionId)) {\n      return\n    }\n\n    const context = this.createContext(extension)\n\n    // 动态加载扩展代码\n    if (extension.main) {\n      // 这里应该实际加载扩展的JS文件\n      console.log(`Activating extension: ${extensionId}`)\n    }\n\n    this.activeExtensions.add(extensionId)\n  }\n\n  deactivateExtension(extensionId: string): void {\n    this.activeExtensions.delete(extensionId)\n  }\n\n  getExtensions(): Extension[] {\n    return Array.from(this.extensions.values())\n  }\n\n  getActiveExtensions(): Extension[] {\n    return this.getExtensions().filter((e) => this.activeExtensions.has(e.id))\n  }\n\n  private createContext(extension: Extension): ExtensionContext {\n    return {\n      subscriptions: [],\n      extensionPath: `/extensions/${extension.id}`,\n      globalState: new Map(),\n      workspaceState: new Map(),\n    }\n  }\n}\n\nexport const extensionLoader = new ExtensionLoader()\n\n"],"names":["i","Object","defineProperty","s","e","t","n","enumerable","configurable","writable","value","o","ExtensionLoader","constructor","__publicField","this","Map","Set","loadExtension","manifest","extension","id","name","version","main","browser","contributes","extensions","set","activateExtension","extensionId","get","Error","activeExtensions","has","createContext","add","deactivateExtension","delete","getExtensions","Array","from","values","getActiveExtensions","filter","subscriptions","extensionPath","globalState","workspaceState","extensionLoader"],"mappings":"aAMO,IAAAA,EAAAC,OAAAC,eAAAC,EAAA,CAAAC,EAAAC,EAAAC,KAAA,EAAAF,EAAAC,EAAAC,KAAAD,KAAAD,EAAAJ,EAAAI,EAAAC,EAAA,CAAAE,YAAA,EAAAC,cAAA,EAAAC,UAAA,EAAAC,MAAAJ,IAAAF,EAAAC,GAAAC,GAAAK,CAAAP,EAAA,iBAAAC,EAAAA,EAAA,GAAAA,EAAAC,GAAAA,GAAA,MAAMM,EAAN,WAAAC,GACLC,EAAAC,KAAQ,aAAa,IAAIC,KACzBF,EAAAC,KAAQ,mBAAmB,IAAIE,IAAA,CAE/B,mBAAMC,CAAcC,GAClB,MAAMC,EAAuB,CAC3BC,GAAI,GAAGF,EAASG,QAAQH,EAASI,UACjCD,KAAMH,EAASG,KACfC,QAASJ,EAASI,QAClBC,KAAML,EAASK,MAAQL,EAASM,SAAW,GAC3CC,YAAaP,EAASO,aAGxB,OAAAX,KAAKY,WAAWC,IAAIR,EAAUC,GAAID,GAC3BA,CACT,CAEA,uBAAMS,CAAkBC,GACtB,MAAMV,EAAYL,KAAKY,WAAWI,IAAID,GACtC,IAAKV,EACH,MAAM,IAAIY,MAAM,wBAAwBF,KAGtCf,KAAKkB,iBAAiBC,IAAIJ,KAIdf,KAAKoB,cAAcf,GAG/BA,EAAUI,KAKdT,KAAKkB,iBAAiBG,IAAIN,GAC5B,CAEA,mBAAAO,CAAoBP,GAClBf,KAAKkB,iBAAiBK,OAAOR,EAC/B,CAEA,aAAAS,GACE,OAAOC,MAAMC,KAAK1B,KAAKY,WAAWe,SACpC,CAEA,mBAAAC,GACE,OAAO5B,KAAKwB,gBAAgBK,OAAQxC,GAAMW,KAAKkB,iBAAiBC,IAAI9B,EAAEiB,IACxE,CAEQ,aAAAc,CAAcf,GACpB,MAAO,CACLyB,cAAe,GACfC,cAAe,eAAe1B,EAAUC,KACxC0B,YAAa,IAAI/B,IACjBgC,eAAgB,IAAIhC,IAExB,EAGK,MAAMiC,EAAkB,IAAIrC"}