{"version":3,"file":"VirtualFileSystem.cjs","sources":["../../../src/features/filesystem/VirtualFileSystem.ts"],"sourcesContent":["/**\n * 虚拟文件系统\n */\n\nimport type { FileNode, FileSystemConfig, FileOperation } from '../../types/filesystem'\n\nexport class VirtualFileSystem {\n  private root: FileNode\n  private files = new Map<string, FileNode>()\n  private config: FileSystemConfig\n\n  constructor(config: FileSystemConfig = {}) {\n    this.config = {\n      rootPath: config.rootPath || '/',\n      maxFileSize: config.maxFileSize || 10 * 1024 * 1024, // 10MB\n      virtualMode: config.virtualMode !== false,\n    }\n\n    this.root = {\n      id: 'root',\n      name: '/',\n      type: 'directory',\n      path: '/',\n      children: [],\n    }\n\n    this.files.set('/', this.root)\n  }\n\n  async createFile(path: string, content = ''): Promise<FileNode> {\n    const name = path.split('/').pop() || ''\n    const file: FileNode = {\n      id: this.generateId(),\n      name,\n      type: 'file',\n      path,\n      content,\n      size: content.length,\n      created: Date.now(),\n      modified: Date.now(),\n    }\n\n    this.files.set(path, file)\n    this.addToParent(path, file)\n    return file\n  }\n\n  async createDirectory(path: string): Promise<FileNode> {\n    const name = path.split('/').pop() || ''\n    const dir: FileNode = {\n      id: this.generateId(),\n      name,\n      type: 'directory',\n      path,\n      children: [],\n      created: Date.now(),\n    }\n\n    this.files.set(path, dir)\n    this.addToParent(path, dir)\n    return dir\n  }\n\n  async readFile(path: string): Promise<string> {\n    const file = this.files.get(path)\n    if (!file || file.type !== 'file') {\n      throw new Error(`File not found: ${path}`)\n    }\n    return file.content || ''\n  }\n\n  async writeFile(path: string, content: string): Promise<void> {\n    let file = this.files.get(path)\n    if (!file) {\n      file = await this.createFile(path, content)\n    } else {\n      file.content = content\n      file.size = content.length\n      file.modified = Date.now()\n    }\n  }\n\n  async deleteFile(path: string): Promise<void> {\n    this.files.delete(path)\n    this.removeFromParent(path)\n  }\n\n  async renameFile(oldPath: string, newPath: string): Promise<void> {\n    const file = this.files.get(oldPath)\n    if (!file) throw new Error(`File not found: ${oldPath}`)\n\n    file.path = newPath\n    file.name = newPath.split('/').pop() || ''\n    this.files.delete(oldPath)\n    this.files.set(newPath, file)\n  }\n\n  getFile(path: string): FileNode | undefined {\n    return this.files.get(path)\n  }\n\n  listDirectory(path: string): FileNode[] {\n    const dir = this.files.get(path)\n    if (!dir || dir.type !== 'directory') return []\n    return dir.children || []\n  }\n\n  getRoot(): FileNode {\n    return this.root\n  }\n\n  private addToParent(path: string, node: FileNode): void {\n    const parentPath = this.getParentPath(path)\n    const parent = this.files.get(parentPath)\n    if (parent && parent.type === 'directory') {\n      if (!parent.children) parent.children = []\n      parent.children.push(node)\n    }\n  }\n\n  private removeFromParent(path: string): void {\n    const parentPath = this.getParentPath(path)\n    const parent = this.files.get(parentPath)\n    if (parent && parent.children) {\n      parent.children = parent.children.filter((c) => c.path !== path)\n    }\n  }\n\n  private getParentPath(path: string): string {\n    const parts = path.split('/').filter(Boolean)\n    parts.pop()\n    return '/' + parts.join('/')\n  }\n\n  private generateId(): string {\n    return `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n  }\n}\n\n"],"names":["constructor","config","__publicField","this","Map","rootPath","maxFileSize","virtualMode","root","id","name","type","path","children","files","set","createFile","content","split","pop","file","generateId","size","length","created","Date","now","modified","addToParent","createDirectory","dir","readFile","get","Error","writeFile","deleteFile","delete","removeFromParent","renameFile","oldPath","newPath","getFile","listDirectory","getRoot","node","parentPath","getParentPath","parent","push","filter","c","parts","Boolean","join","Math","random","toString","substr"],"mappings":"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"}