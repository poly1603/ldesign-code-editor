{"version":3,"file":"FileSearch.cjs","sources":["../../../src/features/filesystem/FileSearch.ts"],"sourcesContent":["/**\n * 文件搜索\n */\n\nimport type { FileNode, FileSearchOptions, FileSearchResult } from '../../types/filesystem'\n\nexport class FileSearch {\n  search(nodes: FileNode[], options: FileSearchOptions): FileSearchResult[] {\n    const results: FileSearchResult[] = []\n    const regex = options.regex\n      ? new RegExp(options.query, options.caseSensitive ? '' : 'i')\n      : null\n\n    const searchText = options.caseSensitive ? options.query : options.query.toLowerCase()\n\n    for (const node of nodes) {\n      if (node.type === 'file') {\n        const nameMatch = this.matchFileName(node.name, searchText, regex, options.caseSensitive)\n\n        if (nameMatch || options.includeContent) {\n          const contentMatches = options.includeContent && node.content\n            ? this.searchInContent(node.content, searchText, regex)\n            : []\n\n          if (nameMatch || contentMatches.length > 0) {\n            results.push({\n              file: node,\n              matches: contentMatches,\n            })\n          }\n        }\n      } else if (node.children) {\n        results.push(...this.search(node.children, options))\n      }\n\n      if (results.length >= (options.maxResults || 100)) {\n        break\n      }\n    }\n\n    return results\n  }\n\n  private matchFileName(\n    name: string,\n    query: string,\n    regex: RegExp | null,\n    caseSensitive?: boolean\n  ): boolean {\n    if (regex) {\n      return regex.test(name)\n    }\n    const testName = caseSensitive ? name : name.toLowerCase()\n    return testName.includes(query)\n  }\n\n  private searchInContent(\n    content: string,\n    query: string,\n    regex: RegExp | null\n  ): Array<{ line: number; column: number; text: string }> {\n    const matches: Array<{ line: number; column: number; text: string }> = []\n    const lines = content.split('\\n')\n\n    lines.forEach((line, index) => {\n      if (regex) {\n        const match = line.match(regex)\n        if (match && match.index !== undefined) {\n          matches.push({ line: index + 1, column: match.index, text: line })\n        }\n      } else {\n        const idx = line.indexOf(query)\n        if (idx !== -1) {\n          matches.push({ line: index + 1, column: idx, text: line })\n        }\n      }\n    })\n\n    return matches\n  }\n}\n\n"],"names":["search","nodes","options","results","regex","RegExp","query","caseSensitive","searchText","toLowerCase","node","type","nameMatch","this","matchFileName","name","includeContent","contentMatches","content","searchInContent","length","push","file","matches","children","maxResults","test","includes","split","forEach","line","index","match","column","text","idx","indexOf"],"mappings":"gCAMO,MACL,MAAAA,CAAOC,EAAmBC,GACxB,MAAMC,EAA8B,GAC9BC,EAAQF,EAAQE,MAClB,IAAIC,OAAOH,EAAQI,MAAOJ,EAAQK,cAAgB,GAAK,KACvD,KAEEC,EAAaN,EAAQK,cAAgBL,EAAQI,MAAQJ,EAAQI,MAAMG,cAEzE,IAAA,MAAWC,KAAQT,EAAO,CACxB,GAAkB,SAAdS,EAAKC,KAAiB,CACxB,MAAMC,EAAYC,KAAKC,cAAcJ,EAAKK,KAAMP,EAAYJ,EAAOF,EAAQK,eAE3E,GAAIK,GAAaV,EAAQc,eAAgB,CACvC,MAAMC,EAAiBf,EAAQc,gBAAkBN,EAAKQ,QAClDL,KAAKM,gBAAgBT,EAAKQ,QAASV,EAAYJ,GAC/C,IAEAQ,GAAaK,EAAeG,OAAS,IACvCjB,EAAQkB,KAAK,CACXC,KAAMZ,EACNa,QAASN,GAGf,CACF,MAAWP,EAAKc,UACdrB,EAAQkB,QAAQR,KAAKb,OAAOU,EAAKc,SAAUtB,IAG7C,GAAIC,EAAQiB,SAAWlB,EAAQuB,YAAc,KAC3C,KAEJ,CAEA,OAAOtB,CACT,CAEQ,aAAAW,CACNC,EACAT,EACAF,EACAG,GAEA,OAAIH,EACKA,EAAMsB,KAAKX,IAEHR,EAAgBQ,EAAOA,EAAKN,eAC7BkB,SAASrB,EAC3B,CAEQ,eAAAa,CACND,EACAZ,EACAF,GAEA,MAAMmB,EAAiE,GAGvE,OAFcL,EAAQU,MAAM,MAEtBC,QAAQ,CAACC,EAAMC,KACnB,GAAI3B,EAAO,CACT,MAAM4B,EAAQF,EAAKE,MAAM5B,GACrB4B,QAAyB,IAAhBA,EAAMD,OACjBR,EAAQF,KAAK,CAAES,KAAMC,EAAQ,EAAGE,OAAQD,EAAMD,MAAOG,KAAMJ,GAE/D,KAAO,CACL,MAAMK,EAAML,EAAKM,QAAQ9B,IACb,IAAR6B,GACFZ,EAAQF,KAAK,CAAES,KAAMC,EAAQ,EAAGE,OAAQE,EAAKD,KAAMJ,GAEvD,IAGKP,CACT"}