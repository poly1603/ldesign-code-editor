{"version":3,"file":"CommandPalette.cjs","sources":["../../../src/features/command/CommandPalette.ts"],"sourcesContent":["/**\n * 命令面板\n */\n\nimport { CommandRegistry } from './CommandRegistry'\nimport type { Command } from './CommandRegistry'\n\nexport interface CommandPaletteOptions {\n  maxResults?: number\n  fuzzySearch?: boolean\n  showKeybindings?: boolean\n  showCategories?: boolean\n}\n\nexport class CommandPalette {\n  private registry: CommandRegistry\n  private options: Required<CommandPaletteOptions>\n  private isOpen = false\n  private selectedIndex = 0\n\n  constructor(registry: CommandRegistry, options: CommandPaletteOptions = {}) {\n    this.registry = registry\n    this.options = {\n      maxResults: options.maxResults || 20,\n      fuzzySearch: options.fuzzySearch !== false,\n      showKeybindings: options.showKeybindings !== false,\n      showCategories: options.showCategories !== false,\n    }\n  }\n\n  open(): void {\n    this.isOpen = true\n    this.selectedIndex = 0\n  }\n\n  close(): void {\n    this.isOpen = false\n  }\n\n  search(query: string): Command[] {\n    if (this.options.fuzzySearch) {\n      return this.fuzzySearch(query)\n    }\n    return this.registry.searchCommands(query).slice(0, this.options.maxResults)\n  }\n\n  private fuzzySearch(query: string): Command[] {\n    const allCommands = this.registry.getAllCommands()\n    const scored = allCommands.map((cmd) => ({\n      command: cmd,\n      score: this.calculateFuzzyScore(query, cmd.title),\n    }))\n\n    return scored\n      .filter((item) => item.score > 0)\n      .sort((a, b) => b.score - a.score)\n      .slice(0, this.options.maxResults)\n      .map((item) => item.command)\n  }\n\n  private calculateFuzzyScore(query: string, text: string): number {\n    const lowerQuery = query.toLowerCase()\n    const lowerText = text.toLowerCase()\n\n    if (lowerText === lowerQuery) return 100\n    if (lowerText.startsWith(lowerQuery)) return 90\n    if (lowerText.includes(lowerQuery)) return 70\n\n    let score = 0\n    let textIndex = 0\n\n    for (const char of lowerQuery) {\n      textIndex = lowerText.indexOf(char, textIndex)\n      if (textIndex === -1) return 0\n      score += 50 / (textIndex + 1)\n      textIndex++\n    }\n\n    return Math.min(score, 100)\n  }\n\n  selectNext(): void {\n    this.selectedIndex++\n  }\n\n  selectPrevious(): void {\n    this.selectedIndex = Math.max(0, this.selectedIndex - 1)\n  }\n\n  async executeSelected(commands: Command[]): Promise<void> {\n    if (this.selectedIndex < commands.length) {\n      await this.registry.executeCommand(commands[this.selectedIndex].id)\n      this.close()\n    }\n  }\n}\n\n"],"names":["constructor","registry","options","__publicField","this","maxResults","fuzzySearch","showKeybindings","showCategories","open","isOpen","selectedIndex","close","search","query","searchCommands","slice","getAllCommands","map","cmd","command","score","calculateFuzzyScore","title","filter","item","sort","a","b","text","lowerQuery","toLowerCase","lowerText","startsWith","includes","textIndex","char","indexOf","Math","min","selectNext","selectPrevious","max","executeSelected","commands","length","executeCommand","id"],"mappings":"oMAcO,MAML,WAAAA,CAAYC,EAA2BC,EAAiC,CAAA,GALxEC,EAAAC,KAAQ,YACRD,EAAAC,KAAQ,WACRD,EAAAC,KAAQ,UAAS,GACjBD,EAAAC,KAAQ,gBAAgB,GAGtBA,KAAKH,SAAWA,EAChBG,KAAKF,QAAU,CACbG,WAAYH,EAAQG,YAAc,GAClCC,aAAqC,IAAxBJ,EAAQI,YACrBC,iBAA6C,IAA5BL,EAAQK,gBACzBC,gBAA2C,IAA3BN,EAAQM,eAE5B,CAEA,IAAAC,GACEL,KAAKM,QAAS,EACdN,KAAKO,cAAgB,CACvB,CAEA,KAAAC,GACER,KAAKM,QAAS,CAChB,CAEA,MAAAG,CAAOC,GACL,OAAIV,KAAKF,QAAQI,YACRF,KAAKE,YAAYQ,GAEnBV,KAAKH,SAASc,eAAeD,GAAOE,MAAM,EAAGZ,KAAKF,QAAQG,WACnE,CAEQ,WAAAC,CAAYQ,GAOlB,OANoBV,KAAKH,SAASgB,iBACPC,IAAKC,IAAAA,CAC9BC,QAASD,EACTE,MAAOjB,KAAKkB,oBAAoBR,EAAOK,EAAII,UAI1CC,OAAQC,GAASA,EAAKJ,MAAQ,GAC9BK,KAAK,CAACC,EAAGC,IAAMA,EAAEP,MAAQM,EAAEN,OAC3BL,MAAM,EAAGZ,KAAKF,QAAQG,YACtBa,IAAKO,GAASA,EAAKL,QACxB,CAEQ,mBAAAE,CAAoBR,EAAee,GACzC,MAAMC,EAAahB,EAAMiB,cACnBC,EAAYH,EAAKE,cAEvB,GAAIC,IAAcF,EAAY,OAAO,IACrC,GAAIE,EAAUC,WAAWH,GAAa,OAAO,GAC7C,GAAIE,EAAUE,SAASJ,GAAa,OAAO,GAE3C,IAAIT,EAAQ,EACRc,EAAY,EAEhB,IAAA,MAAWC,KAAQN,EAAY,CAE7B,GADAK,EAAYH,EAAUK,QAAQD,EAAMD,IAClB,IAAdA,EAAkB,OAAO,EAC7Bd,GAAS,IAAMc,EAAY,GAC3BA,GACF,CAEA,OAAOG,KAAKC,IAAIlB,EAAO,IACzB,CAEA,UAAAmB,GACEpC,KAAKO,eACP,CAEA,cAAA8B,GACErC,KAAKO,cAAgB2B,KAAKI,IAAI,EAAGtC,KAAKO,cAAgB,EACxD,CAEA,qBAAMgC,CAAgBC,GAChBxC,KAAKO,cAAgBiC,EAASC,eAC1BzC,KAAKH,SAAS6C,eAAeF,EAASxC,KAAKO,eAAeoC,IAChE3C,KAAKQ,QAET"}