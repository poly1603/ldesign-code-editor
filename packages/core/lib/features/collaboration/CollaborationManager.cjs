"use strict";var e=require("./WebSocketClient.cjs"),s=require("./CRDTEngine.cjs"),t=require("./UserPresence.cjs"),n=Object.defineProperty,i=(e,s,t)=>(((e,s,t)=>{s in e?n(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t})(e,"symbol"!=typeof s?s+"":s,t),t);exports.CollaborationManager=class{constructor(n,r={}){i(this,"wsClient"),i(this,"crdt"),i(this,"presence"),i(this,"config"),i(this,"events"),this.config=n,this.events=r,this.crdt=new s.CRDTEngine(n.user.id,""),this.presence=new t.UserPresenceManager(n.user.id),this.wsClient=new e.WebSocketClient({url:n.serverUrl,onOpen:()=>this.handleConnect(),onClose:()=>this.handleDisconnect(),onError:e=>r.onError?.(e),onMessage:e=>this.handleMessage(e)}),!1!==n.autoConnect&&this.connect()}async connect(){await this.wsClient.connect()}disconnect(){this.wsClient.close()}sendEdit(e){const s=this.crdt.fromEditorOperation(e);this.wsClient.send({type:"edit",senderId:this.config.user.id,timestamp:Date.now(),data:s})}handleConnect(){this.wsClient.send({type:"join",senderId:this.config.user.id,timestamp:Date.now(),data:{user:this.config.user,roomId:this.config.roomId}})}handleDisconnect(){this.events.onUserLeft?.(this.config.user.id)}handleMessage(e){switch(e.type){case"join":this.presence.addUser(e.data),this.events.onUserJoined?.(e.data);break;case"leave":this.presence.removeUser(e.senderId),this.events.onUserLeft?.(e.senderId);break;case"edit":this.crdt.applyRemoteOperation(e.data),this.events.onEdit?.(this.crdt.toEditorOperation(e.data));break;case"cursor":this.presence.updateCursor(e.senderId,e.data),this.events.onCursorChange?.(e.senderId,e.data)}}dispose(){this.disconnect()}};
//# sourceMappingURL=CollaborationManager.cjs.map
