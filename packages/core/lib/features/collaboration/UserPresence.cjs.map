{"version":3,"file":"UserPresence.cjs","sources":["../../../src/features/collaboration/UserPresence.ts"],"sourcesContent":["/**\n * 用户在线状态管理\n */\n\nimport type { UserInfo, UserPresence, CursorPosition, SelectionRange } from '../../types/collaboration'\n\nexport class UserPresenceManager {\n  private users = new Map<string, UserPresence>()\n  private currentUserId: string\n  private callbacks = new Set<(users: UserPresence[]) => void>()\n\n  constructor(currentUserId: string) {\n    this.currentUserId = currentUserId\n  }\n\n  addUser(user: UserInfo): void {\n    this.users.set(user.id, {\n      ...user,\n      online: true,\n      lastSeen: Date.now(),\n    })\n    this.notifyChange()\n  }\n\n  removeUser(userId: string): void {\n    const user = this.users.get(userId)\n    if (user) {\n      user.online = false\n      user.lastSeen = Date.now()\n    }\n    this.notifyChange()\n  }\n\n  updateCursor(userId: string, position: CursorPosition): void {\n    const user = this.users.get(userId)\n    if (user) {\n      user.cursor = position\n      user.lastSeen = Date.now()\n      this.notifyChange()\n    }\n  }\n\n  updateSelection(userId: string, selection: SelectionRange): void {\n    const user = this.users.get(userId)\n    if (user) {\n      user.selection = selection\n      user.lastSeen = Date.now()\n      this.notifyChange()\n    }\n  }\n\n  getUsers(): UserPresence[] {\n    return Array.from(this.users.values())\n  }\n\n  getOnlineUsers(): UserPresence[] {\n    return this.getUsers().filter((u) => u.online && u.id !== this.currentUserId)\n  }\n\n  onChange(callback: (users: UserPresence[]) => void): () => void {\n    this.callbacks.add(callback)\n    return () => this.callbacks.delete(callback)\n  }\n\n  private notifyChange(): void {\n    const users = this.getUsers()\n    this.callbacks.forEach((cb) => cb(users))\n  }\n\n  clear(): void {\n    this.users.clear()\n    this.notifyChange()\n  }\n}\n\n"],"names":["i","Object","defineProperty","n","t","e","s","enumerable","configurable","writable","value","o","constructor","currentUserId","__publicField","this","Map","Set","addUser","user","users","set","id","online","lastSeen","Date","now","notifyChange","removeUser","userId","get","updateCursor","position","cursor","updateSelection","selection","getUsers","Array","from","values","getOnlineUsers","filter","u","onChange","callback","callbacks","add","delete","forEach","cb","clear"],"mappings":"aAMO,IAAAA,EAAAC,OAAAC,eAAAC,EAAA,CAAAC,EAAAC,EAAAC,KAAA,EAAAF,EAAAC,EAAAC,KAAAD,KAAAD,EAAAJ,EAAAI,EAAAC,EAAA,CAAAE,YAAA,EAAAC,cAAA,EAAAC,UAAA,EAAAC,MAAAJ,IAAAF,EAAAC,GAAAC,GAAAK,CAAAP,EAAA,iBAAAC,EAAAA,EAAA,GAAAA,EAAAC,GAAAA,+BAAA,MAKL,WAAAM,CAAYC,GAJZC,EAAAC,KAAQ,QAAQ,IAAIC,KACpBF,EAAAC,KAAQ,iBACRD,EAAAC,KAAQ,YAAY,IAAIE,KAGtBF,KAAKF,cAAgBA,CACvB,CAEA,OAAAK,CAAQC,GACNJ,KAAKK,MAAMC,IAAIF,EAAKG,GAAI,IACnBH,EACHI,QAAQ,EACRC,SAAUC,KAAKC,QAEjBX,KAAKY,cACP,CAEA,UAAAC,CAAWC,GACT,MAAMV,EAAOJ,KAAKK,MAAMU,IAAID,GACxBV,IACFA,EAAKI,QAAS,EACdJ,EAAKK,SAAWC,KAAKC,OAEvBX,KAAKY,cACP,CAEA,YAAAI,CAAaF,EAAgBG,GAC3B,MAAMb,EAAOJ,KAAKK,MAAMU,IAAID,GACxBV,IACFA,EAAKc,OAASD,EACdb,EAAKK,SAAWC,KAAKC,MACrBX,KAAKY,eAET,CAEA,eAAAO,CAAgBL,EAAgBM,GAC9B,MAAMhB,EAAOJ,KAAKK,MAAMU,IAAID,GACxBV,IACFA,EAAKgB,UAAYA,EACjBhB,EAAKK,SAAWC,KAAKC,MACrBX,KAAKY,eAET,CAEA,QAAAS,GACE,OAAOC,MAAMC,KAAKvB,KAAKK,MAAMmB,SAC/B,CAEA,cAAAC,GACE,OAAOzB,KAAKqB,WAAWK,OAAQC,GAAMA,EAAEnB,QAAUmB,EAAEpB,KAAOP,KAAKF,cACjE,CAEA,QAAA8B,CAASC,GACP,YAAKC,UAAUC,IAAIF,GACZ,IAAM7B,KAAK8B,UAAUE,OAAOH,EACrC,CAEQ,YAAAjB,GACN,MAAMP,EAAQL,KAAKqB,WACnBrB,KAAK8B,UAAUG,QAASC,GAAOA,EAAG7B,GACpC,CAEA,KAAA8B,GACEnC,KAAKK,MAAM8B,QACXnC,KAAKY,cACP"}