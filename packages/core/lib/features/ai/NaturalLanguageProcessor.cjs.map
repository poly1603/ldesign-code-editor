{"version":3,"file":"NaturalLanguageProcessor.cjs","sources":["../../../src/features/ai/NaturalLanguageProcessor.ts"],"sourcesContent":["/**\n * 自然语言处理器\n * 处理自然语言查询并转换为代码\n */\n\nimport type { AIService } from './AIService'\nimport type { NaturalLanguageRequest, CodeContext } from '../../types/ai'\n\nexport interface NLProcessorOptions {\n  aiService: AIService\n  defaultLanguage?: string\n  enableTemplates?: boolean\n}\n\n/**\n * 自然语言处理器类\n */\nexport class NaturalLanguageProcessor {\n  private aiService: AIService\n  private options: Required<NLProcessorOptions>\n  private templates = new Map<string, string>()\n\n  constructor(options: NLProcessorOptions) {\n    this.aiService = options.aiService\n    this.options = {\n      aiService: options.aiService,\n      defaultLanguage: options.defaultLanguage || 'javascript',\n      enableTemplates: options.enableTemplates !== false,\n    }\n\n    if (this.options.enableTemplates) {\n      this.initializeTemplates()\n    }\n  }\n\n  /**\n   * 初始化模板\n   */\n  private initializeTemplates(): void {\n    this.templates.set('create function', 'function ${name}(${params}) {\\n  ${body}\\n}')\n    this.templates.set('create class', 'class ${name} {\\n  constructor(${params}) {\\n    ${body}\\n  }\\n}')\n    this.templates.set('create array', 'const ${name} = [${items}]')\n    this.templates.set('create object', 'const ${name} = {\\n  ${properties}\\n}')\n    this.templates.set('for loop', 'for (let i = 0; i < ${length}; i++) {\\n  ${body}\\n}')\n    this.templates.set('if statement', 'if (${condition}) {\\n  ${body}\\n}')\n    this.templates.set('try catch', 'try {\\n  ${body}\\n} catch (error) {\\n  ${handler}\\n}')\n  }\n\n  /**\n   * 处理自然语言查询\n   */\n  async process(query: string, context?: CodeContext): Promise<string> {\n    // 尝试匹配模板\n    if (this.options.enableTemplates) {\n      const template = this.matchTemplate(query)\n      if (template) {\n        return this.fillTemplate(template, query)\n      }\n    }\n\n    // 使用 AI 转换\n    const request: NaturalLanguageRequest = {\n      query,\n      context,\n      targetLanguage: context?.language || this.options.defaultLanguage,\n    }\n\n    return await this.aiService.naturalLanguageToCode(request)\n  }\n\n  /**\n   * 匹配模板\n   */\n  private matchTemplate(query: string): string | null {\n    const normalizedQuery = query.toLowerCase().trim()\n\n    for (const [pattern, template] of this.templates) {\n      if (normalizedQuery.includes(pattern)) {\n        return template\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * 填充模板\n   */\n  private fillTemplate(template: string, query: string): string {\n    // 简单的模板填充\n    let filled = template\n\n    // 提取名称\n    const nameMatch = query.match(/(?:named|called)\\s+(\\w+)/i)\n    if (nameMatch) {\n      filled = filled.replace('${name}', nameMatch[1])\n    } else {\n      filled = filled.replace('${name}', 'myFunction')\n    }\n\n    // 填充占位符\n    filled = filled.replace(/\\$\\{(\\w+)\\}/g, (_match, placeholder) => {\n      return `/* ${placeholder} */`\n    })\n\n    return filled\n  }\n\n  /**\n   * 解析命令\n   */\n  parseCommand(query: string): {\n    action: string\n    target: string\n    parameters: Record<string, string>\n  } | null {\n    const commandPatterns = [\n      {\n        pattern: /create\\s+(?:a\\s+)?(\\w+)(?:\\s+named\\s+(\\w+))?/i,\n        action: 'create',\n      },\n      {\n        pattern: /add\\s+(\\w+)\\s+to\\s+(\\w+)/i,\n        action: 'add',\n      },\n      {\n        pattern: /remove\\s+(\\w+)\\s+from\\s+(\\w+)/i,\n        action: 'remove',\n      },\n      {\n        pattern: /update\\s+(\\w+)\\s+(?:to|with)\\s+(.+)/i,\n        action: 'update',\n      },\n    ]\n\n    for (const { pattern, action } of commandPatterns) {\n      const match = query.match(pattern)\n      if (match) {\n        return {\n          action,\n          target: match[1] || '',\n          parameters: this.extractParameters(query),\n        }\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * 提取参数\n   */\n  private extractParameters(query: string): Record<string, string> {\n    const parameters: Record<string, string> = {}\n\n    // 提取名称\n    const nameMatch = query.match(/named\\s+(\\w+)/i)\n    if (nameMatch) {\n      parameters.name = nameMatch[1]\n    }\n\n    // 提取参数\n    const paramsMatch = query.match(/with\\s+(?:parameters?|params?)\\s+(.+?)(?:\\s+that|\\s+which|$)/i)\n    if (paramsMatch) {\n      parameters.params = paramsMatch[1]\n    }\n\n    // 提取类型\n    const typeMatch = query.match(/of\\s+type\\s+(\\w+)/i)\n    if (typeMatch) {\n      parameters.type = typeMatch[1]\n    }\n\n    return parameters\n  }\n\n  /**\n   * 生成代码片段\n   */\n  generateSnippet(command: ReturnType<typeof this.parseCommand>): string {\n    if (!command) {\n      return ''\n    }\n\n    const { action, target, parameters } = command\n    const name = parameters.name || 'myVariable'\n\n    switch (action) {\n      case 'create':\n        return this.generateCreateSnippet(target, name, parameters)\n\n      case 'add':\n        return `${target}.push(${name})`\n\n      case 'remove':\n        return `${target}.splice(${target}.indexOf(${name}), 1)`\n\n      case 'update':\n        return `${target} = ${name}`\n\n      default:\n        return ''\n    }\n  }\n\n  /**\n   * 生成创建片段\n   */\n  private generateCreateSnippet(\n    type: string,\n    name: string,\n    parameters: Record<string, string>\n  ): string {\n    switch (type.toLowerCase()) {\n      case 'function':\n        return `function ${name}(${parameters.params || ''}) {\\n  // TODO: Implement\\n}`\n\n      case 'class':\n        return `class ${name} {\\n  constructor(${parameters.params || ''}) {\\n    // TODO: Implement\\n  }\\n}`\n\n      case 'variable':\n      case 'const':\n        return `const ${name} = ${parameters.value || 'null'}`\n\n      case 'array':\n        return `const ${name} = []`\n\n      case 'object':\n        return `const ${name} = {}`\n\n      default:\n        return `// TODO: Create ${type} ${name}`\n    }\n  }\n\n  /**\n   * 验证生成的代码\n   */\n  async validateCode(code: string, language: string): Promise<boolean> {\n    try {\n      // 这里可以集成语法检查器\n      // 例如：使用 esprima, acorn 等进行 JavaScript 语法检查\n      return code.trim().length > 0\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * 添加自定义模板\n   */\n  addTemplate(pattern: string, template: string): void {\n    this.templates.set(pattern, template)\n  }\n\n  /**\n   * 移除模板\n   */\n  removeTemplate(pattern: string): boolean {\n    return this.templates.delete(pattern)\n  }\n\n  /**\n   * 获取所有模板\n   */\n  getTemplates(): Map<string, string> {\n    return new Map(this.templates)\n  }\n\n  /**\n   * 清除所有模板\n   */\n  clearTemplates(): void {\n    this.templates.clear()\n  }\n}\n\n"],"names":["constructor","options","__publicField","this","Map","aiService","defaultLanguage","enableTemplates","initializeTemplates","templates","set","process","query","context","template","matchTemplate","fillTemplate","request","targetLanguage","language","naturalLanguageToCode","normalizedQuery","toLowerCase","trim","pattern","includes","filled","nameMatch","match","replace","_match","placeholder","parseCommand","commandPatterns","action","target","parameters","extractParameters","name","paramsMatch","params","typeMatch","type","generateSnippet","command","generateCreateSnippet","value","validateCode","code","length","addTemplate","removeTemplate","delete","getTemplates","clearTemplates","clear"],"mappings":"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"}